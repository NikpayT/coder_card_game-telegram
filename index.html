<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL Code Collector Game</title>
    <style>
        /* CSS Variables for easy theme changes */
        :root {
            --primary-color: #4CAF50; /* Green for main actions */
            --primary-hover-color: #45a049;
            --secondary-color: #2196F3; /* Blue for info/secondary actions */
            --secondary-hover-color: #1976D2;
            --danger-color: #f44336; /* Red for destructive actions */
            --danger-hover-color: #d32f2f;
            --background-color: #e0f2f7; /* Light blue-grey background */
            --card-background: #ffffff;
            --text-color: #333333;
            --light-text-color: #757575;
            --border-radius: 12px;
            --shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--background-color);
            color: var(--text-color);
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            box-sizing: border-box;
        }

        .game-container {
            max-width: 600px;
            width: 100%;
            margin: 20px auto;
            padding: 25px;
            background-color: var(--card-background);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            animation: fadeIn 0.5s ease-out;
            box-sizing: border-box;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .header-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            font-size: 1.1em;
            color: var(--light-text-color);
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        .header-info #experienceDisplay {
            font-weight: bold;
            color: var(--primary-color);
        }
        .header-info #levelDisplay {
            font-weight: bold;
            color: var(--secondary-color);
            margin-left: 10px;
        }
        .progress-bar-container {
            background-color: #e0e0e0;
            border-radius: 5px;
            height: 8px;
            margin-top: 5px;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            width: 0%;
            background-color: var(--secondary-color);
            border-radius: 5px;
            transition: width 0.3s ease-out;
        }

        .message {
            margin-bottom: 20px;
            font-size: 1.2em;
            font-weight: 500;
            color: var(--text-color);
        }

        .buttons-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }

        button {
            padding: 12px 18px;
            font-size: 1em;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            background-color: var(--primary-color);
            color: white;
            transition: background-color 0.2s ease, transform 0.1s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
            font-weight: 600;
        }
        button:hover {
            background-color: var(--primary-hover-color);
            transform: translateY(-2px);
        }
        button:active {
            transform: translateY(0);
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            box-shadow: none;
        }

        .secondary-button {
            background-color: var(--secondary-color);
        }
        .secondary-button:hover {
            background-color: var(--secondary-hover-color);
        }

        .danger-button {
            background-color: var(--danger-color);
        }
        .danger-button:hover {
            background-color: var(--danger-hover-color);
        }

        /* General list item styling */
        .list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin-bottom: 10px;
            background-color: #f7f7f7;
            border-radius: 8px;
            border: 1px solid #eee;
            text-align: left;
            flex-wrap: wrap;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            transition: background-color 0.2s ease;
        }
        .list-item:hover {
            background-color: #f0f0f0;
        }

        .list-item-main {
            flex-grow: 1;
            padding-right: 15px;
            cursor: pointer;
        }
        .list-item-name {
            font-weight: 600;
            font-size: 1.05em;
            color: var(--text-color);
        }
        .list-item-description {
            font-size: 0.85em;
            color: var(--light-text-color);
            margin-top: 5px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
            opacity: 0;
            width: 100%;
        }
        .list-item-description.show {
            max-height: 100px; /* Adjust as needed for description length */
            opacity: 1;
        }

        .item-action-button {
            padding: 8px 12px;
            font-size: 0.85em;
            border-radius: 6px;
            margin-left: 10px;
            flex-shrink: 0;
            box-shadow: none; /* Remove shadow to blend better */
        }
        .item-action-button:hover {
             transform: translateY(-1px);
             box-shadow: 0 1px 3px rgba(0, 0, 0, 0.15);
        }

        /* Specific button colors for list items */
        .buy-button {
            background-color: var(--secondary-color); /* Blue for buy */
        }
        .buy-button:hover {
            background-color: var(--secondary-hover-color);
        }
        .sell-button {
            background-color: var(--danger-color); /* Red for sell */
        }
        .sell-button:hover {
            background-color: var(--danger-hover-color);
        }

        h3 {
            color: var(--primary-color);
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        #collectionHeader {
            color: var(--secondary-color);
            font-size: 1.2em;
        }

        /* Achievements Panel */
        #achievementsPanel, #dailyBonusPanel, #statsPanel {
            background-color: #f7f7f7;
            padding: 15px;
            border-radius: var(--border-radius);
            margin-top: 20px;
            text-align: left;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }
        .achievement-item {
            padding: 10px;
            margin-bottom: 8px;
            border-bottom: 1px dashed #eee;
            color: var(--text-color);
        }
        .achievement-item:last-child {
            border-bottom: none;
        }
        .achievement-item.completed {
            color: var(--primary-color);
            font-weight: 600;
            background-color: #e8f5e9; /* Light green */
            border-radius: 5px;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .achievement-item.completed span {
            font-size: 1.2em; /* Bigger checkmark */
        }

        /* Daily Bonus Panel */
        #dailyBonusPanel h3 {
            color: #ff9800; /* Orange for daily bonus */
        }
        #dailyBonusButton {
            background-color: #ffc107; /* Yellow */
            color: #333;
        }
        #dailyBonusButton:hover {
            background-color: #ffb300;
        }

        /* Stats Panel */
        #statsPanel p {
            margin: 5px 0;
            font-size: 0.95em;
            color: var(--light-text-color);
        }
        #statsPanel strong {
            color: var(--text-color);
        }


        /* Version Info */
        .version-info {
            font-size: 0.75em;
            color: #aaaaaa;
            margin-top: 25px;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header-info">
            <div>
                <span id="experienceDisplay">–û–ø—ã—Ç: 0 üåü</span>
                <span id="levelDisplay">–£—Ä–æ–≤–µ–Ω—å: 1 (0/100 XP)</span>
                <div class="progress-bar-container">
                    <div id="levelProgressBar" class="progress-bar"></div>
                </div>
            </div>
            <span id="gameMessage" class="message">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∏–≥—Ä—É "–°–±–æ—Ä—â–∏–∫ SQL-—Ñ—É–Ω–∫—Ü–∏–π"! üöÄ</span>
        </div>

        <div class="buttons-container" id="mainButtons">
            <button id="collectButton">–ù–∞–π—Ç–∏ SQL-—Ñ—É–Ω–∫—Ü–∏—é üîç</button>
            <button id="viewCollectionButton" class="secondary-button">–ú–æ—è –∫–æ–ª–ª–µ–∫—Ü–∏—è SQL üéí</button>
            <button id="shopButton" class="secondary-button">–ú–∞–≥–∞–∑–∏–Ω üí∞</button>
            <button id="dailyBonusButton" class="secondary-button">–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å üéÅ</button>
            <button id="achievementsButton" class="secondary-button">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è üèÜ</button>
            <button id="statsButton" class="secondary-button">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ üìà</button>
            <button id="createButton" class="secondary-button">–°–æ–∑–¥–∞—Ç—å SQL-–∑–∞–ø—Ä–æ—Å üí°</button>
        </div>

        <div id="collectionDisplay" style="display: none; margin-top: 20px;">
            <h3 id="collectionHeader">–ú–æ—è –∫–æ–ª–ª–µ–∫—Ü–∏—è SQL: (0/55)</h3>
            <div id="collectionList">
                <p>–ü–æ–∫–∞ –Ω–∏—á–µ–≥–æ –Ω–µ—Ç...</p>
            </div>
            <button id="backFromCollection" class="secondary-button">–ù–∞–∑–∞–¥</button>
        </div>

        <div id="createPanel" style="display: none; margin-top: 20px;">
            <h3>–°–æ–∑–¥–∞–Ω–∏–µ SQL-–∑–∞–ø—Ä–æ—Å–∞:</h3>
            <div id="availableParts">
                <p>–ó–¥–µ—Å—å –≤—ã —Å–º–æ–∂–µ—Ç–µ –æ–±—ä–µ–¥–∏–Ω—è—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤! (–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)</p>
            </div>
            <button id="backFromCreate" class="secondary-button">–ù–∞–∑–∞–¥</button>
        </div>

        <div id="shopPanel" style="display: none; margin-top: 20px;">
            <h3>–ú–∞–≥–∞–∑–∏–Ω SQL-—Ñ—É–Ω–∫—Ü–∏–π:</h3>
            <div id="buyableItemsList">
                <p>–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ–±—Ä–∞–Ω—ã!</p>
            </div>
            <button id="backFromShop" class="secondary-button">–ù–∞–∑–∞–¥</button>
        </div>

        <div id="dailyBonusPanel" style="display: none; margin-top: 20px;">
            <h3>–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å!</h3>
            <p id="dailyBonusMessage">–ó–∞–±–µ—Ä–∏—Ç–µ —Å–≤–æ–π –±–æ–Ω—É—Å!</p>
            <button id="claimDailyBonusButton" class="secondary-button">–ó–∞–±—Ä–∞—Ç—å –±–æ–Ω—É—Å (5 üåü)</button>
            <button id="backFromDailyBonus" class="secondary-button" style="margin-top: 10px;">–ù–∞–∑–∞–¥</button>
        </div>

        <div id="achievementsPanel" style="display: none; margin-top: 20px;">
            <h3>–í–∞—à–∏ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h3>
            <div id="achievementsList">
                </div>
            <button id="backFromAchievements" class="secondary-button">–ù–∞–∑–∞–¥</button>
        </div>

        <div id="statsPanel" style="display: none; margin-top: 20px;">
            <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
            <p>–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –Ω–∞–π–¥–µ–Ω–æ: <strong id="statsUniqueCount">0</strong></p>
            <p>–í—Å–µ–≥–æ —Ñ—É–Ω–∫—Ü–∏–π (–≤–∫–ª—é—á–∞—è –¥—É–±–ª–∏–∫–∞—Ç—ã): <strong id="statsTotalCount">0</strong></p>
            <p>–û–ø—ã—Ç–∞ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: <strong id="statsExperienceEarned">0</strong></p>
            <p>–§—É–Ω–∫—Ü–∏–π –ø—Ä–æ–¥–∞–Ω–æ: <strong id="statsPartsSold">0</strong></p>
            <p>–§—É–Ω–∫—Ü–∏–π –∫—É–ø–ª–µ–Ω–æ: <strong id="statsPartsBought">0</strong></p>
            <button id="backFromStats" class="secondary-button">–ù–∞–∑–∞–¥</button>
        </div>


        <button id="resetGameButton" class="danger-button" style="margin-top: 25px;">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É –∑–∞–Ω–æ–≤–æ (—É–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ)</button>
    </div> <div class="version-info">
        –í–µ—Ä—Å–∏—è: <span id="gameVersion">0.4.0</span>
    </div>

    <script src="game_data.js"></script>

    <script>
        // --- –ò–≥—Ä–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ ---
        let gameData = {
            message: "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∏–≥—Ä—É!",
            collection: [], // [{id: 'sql_select', count: 1}]
            experience: 0,
            level: 1,
            xpToNextLevel: 100,
            currentXp: 0, // –û–ø—ã—Ç –Ω–∞ —Ç–µ–∫—É—â–µ–º —É—Ä–æ–≤–Ω–µ
            totalXpEarned: 0, // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–≥–æ –æ–ø—ã—Ç–∞ –∑–∞ –≤—Å–µ –≤—Ä–µ–º—è
            partsSold: 0,
            partsBought: 0,
            lastDailyBonusClaim: 0, // Timestamp –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –±–æ–Ω—É—Å–∞
            achievements: { // –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
                collect_5_unique: { completed: false, reward: 10 },
                collect_10_unique: { completed: false, reward: 20 },
                collect_20_unique: { completed: false, reward: 40 },
                earn_50_xp: { completed: false, reward: 15 },
                sell_5_parts: { completed: false, reward: 10 }
            },
            currentView: 'main' // 'main', 'collection', 'create', 'shop', 'daily_bonus', 'achievements', 'stats'
        };

        const PART_PRICE = 1; // –°—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–∫—É–ø–∫–∏/–ø—Ä–æ–¥–∞–∂–∏ –æ–¥–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
        const XP_PER_LEVEL_BASE = 100; // –ë–∞–∑–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ XP –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è
        const XP_PER_LEVEL_MULTIPLIER = 1.2; // –ú–Ω–æ–∂–∏—Ç–µ–ª—å –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è XP —Å –∫–∞–∂–¥—ã–º —É—Ä–æ–≤–Ω–µ–º
        const DAILY_BONUS_AMOUNT = 5; // –°–∫–æ–ª—å–∫–æ –æ–ø—ã—Ç–∞ –¥–∞—ë—Ç –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å
        const DAILY_BONUS_COOLDOWN_MS = 24 * 60 * 60 * 1000; // 24 —á–∞—Å–∞ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö

        // --- DOM-—ç–ª–µ–º–µ–Ω—Ç—ã (–∫–µ—à–∏—Ä—É–µ–º –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏) ---
        const gameMessageElement = document.getElementById('gameMessage');
        const experienceDisplay = document.getElementById('experienceDisplay');
        const levelDisplay = document.getElementById('levelDisplay');
        const levelProgressBar = document.getElementById('levelProgressBar');
        const mainButtonsContainer = document.getElementById('mainButtons'); // –û–±–Ω–æ–≤–∏–ª–∏ ID

        const collectButton = document.getElementById('collectButton');
        const viewCollectionButton = document.getElementById('viewCollectionButton');
        const createButton = document.getElementById('createButton');
        const shopButton = document.getElementById('shopButton');
        const dailyBonusButton = document.getElementById('dailyBonusButton'); // –ù–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞
        const achievementsButton = document.getElementById('achievementsButton'); // –ù–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞
        const statsButton = document.getElementById('statsButton'); // –ù–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞

        const collectionDisplay = document.getElementById('collectionDisplay');
        const collectionHeader = document.getElementById('collectionHeader');
        const collectionList = document.getElementById('collectionList');
        const backFromCollectionButton = document.getElementById('backFromCollection');

        const createPanel = document.getElementById('createPanel');
        const availablePartsDiv = document.getElementById('availableParts');
        const backFromCreateButton = document.getElementById('backFromCreate');

        const shopPanel = document.getElementById('shopPanel');
        const buyableItemsList = document.getElementById('buyableItemsList');
        const backFromShopButton = document.getElementById('backFromShop');

        const dailyBonusPanel = document.getElementById('dailyBonusPanel'); // –ù–æ–≤–∞—è –ø–∞–Ω–µ–ª—å
        const dailyBonusMessage = document.getElementById('dailyBonusMessage'); // –ù–æ–≤–∞—è
        const claimDailyBonusButton = document.getElementById('claimDailyBonusButton'); // –ù–æ–≤–∞—è
        const backFromDailyBonusButton = document.getElementById('backFromDailyBonus'); // –ù–æ–≤–∞—è

        const achievementsPanel = document.getElementById('achievementsPanel'); // –ù–æ–≤–∞—è –ø–∞–Ω–µ–ª—å
        const achievementsList = document.getElementById('achievementsList'); // –ù–æ–≤–∞—è
        const backFromAchievementsButton = document.getElementById('backFromAchievements'); // –ù–æ–≤–∞—è

        const statsPanel = document.getElementById('statsPanel'); // –ù–æ–≤–∞—è –ø–∞–Ω–µ–ª—å
        const statsUniqueCount = document.getElementById('statsUniqueCount');
        const statsTotalCount = document.getElementById('statsTotalCount');
        const statsExperienceEarned = document.getElementById('statsExperienceEarned');
        const statsPartsSold = document.getElementById('statsPartsSold');
        const statsPartsBought = document.getElementById('statsPartsBought');
        const backFromStatsButton = document.getElementById('backFromStats');

        const resetGameButton = document.getElementById('resetGameButton');


        // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App SDK ---
        if (window.Telegram && window.Telegram.WebApp) {
            Telegram.WebApp.ready();
            Telegram.WebApp.expand();
            console.log('Telegram WebApp initialized.');
        } else {
            console.warn('Telegram WebApp script not loaded or not in Telegram environment.');
        }

        // --- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ UI –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ ---
        function updateUI() {
            gameMessageElement.textContent = gameData.message;
            experienceDisplay.textContent = `–û–ø—ã—Ç: ${gameData.experience} üåü`;

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞
            levelDisplay.textContent = `–£—Ä–æ–≤–µ–Ω—å: ${gameData.level} (${gameData.currentXp}/${gameData.xpToNextLevel} XP)`;
            const progressPercentage = (gameData.currentXp / gameData.xpToNextLevel) * 100;
            levelProgressBar.style.width = `${progressPercentage}%`;


            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –ø–∞–Ω–µ–ª–∏
            mainButtonsContainer.style.display = 'none';
            collectionDisplay.style.display = 'none';
            createPanel.style.display = 'none';
            shopPanel.style.display = 'none';
            dailyBonusPanel.style.display = 'none';
            achievementsPanel.style.display = 'none';
            statsPanel.style.display = 'none';
            resetGameButton.style.display = 'none';

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é –ø–∞–Ω–µ–ª—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ –≤–∏–¥–∞
            if (gameData.currentView === 'main') {
                mainButtonsContainer.style.display = 'grid';
                resetGameButton.style.display = 'block';
                checkDailyBonusAvailability(); // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –±–æ–Ω—É—Å–∞
            } else if (gameData.currentView === 'collection') {
                collectionDisplay.style.display = 'block';
                renderCollection();
            } else if (gameData.currentView === 'create') {
                createPanel.style.display = 'block';
                renderCreatePanel();
            } else if (gameData.currentView === 'shop') {
                shopPanel.style.display = 'block';
                renderShopItems();
            } else if (gameData.currentView === 'daily_bonus') {
                dailyBonusPanel.style.display = 'block';
                checkDailyBonusAvailability(); // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∏ –∫–Ω–æ–ø–∫—É
            } else if (gameData.currentView === 'achievements') {
                achievementsPanel.style.display = 'block';
                renderAchievements();
            } else if (gameData.currentView === 'stats') {
                statsPanel.style.display = 'block';
                renderStats();
            }
        }

        // --- –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –ø–∞–Ω–µ–ª–µ–π ---
        function renderCollection() {
            const uniquePartsCount = gameData.collection.length;
            const totalPartsCount = ALL_CODE_PARTS.length;
            collectionHeader.textContent = `–ú–æ—è –∫–æ–ª–ª–µ–∫—Ü–∏—è SQL: (${uniquePartsCount}/${totalPartsCount})`;

            if (gameData.collection.length === 0) {
                collectionList.innerHTML = '<p>–ü–æ–∫–∞ –Ω–∏—á–µ–≥–æ –Ω–µ—Ç...</p>';
            } else {
                collectionList.innerHTML = '';
                const sortedCollection = [...gameData.collection].sort((a, b) => a.name.localeCompare(b.name));

                sortedCollection.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'list-item';
                    div.innerHTML = `
                        <div class="list-item-main" id="coll-main-${item.id}">
                            <span class="list-item-name">${item.emoji} ${item.name} (x${item.count})</span>
                            <div class="list-item-description" id="coll-desc-${item.id}">
                                ${item.description}
                            </div>
                        </div>
                        <button class="item-action-button sell-button" data-item-id="${item.id}">–ü—Ä–æ–¥–∞—Ç—å (${PART_PRICE} üåü)</button>
                    `;
                    div.querySelector('.sell-button').onclick = (event) => {
                        event.stopPropagation();
                        sellPart(item.id);
                    };
                    div.querySelector('.list-item-main').onclick = () => {
                        const descElement = document.getElementById(`coll-desc-${item.id}`);
                        if (descElement) {
                            descElement.classList.toggle('show');
                        }
                    };
                    collectionList.appendChild(div);
                });
            }
        }

        function renderCreatePanel() {
            // –≠—Ç–∞ –ø–∞–Ω–µ–ª—å –ø–æ–∫–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –∑–∞–≥–ª—É—à–∫–æ–π, –∫–∞–∫ –∏ –ø—Ä–æ—Å–∏–ª–∏
            availablePartsDiv.innerHTML = '<p>–ó–¥–µ—Å—å –≤—ã —Å–º–æ–∂–µ—Ç–µ –æ–±—ä–µ–¥–∏–Ω—è—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤! (–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)</p>';
        }

        function renderShopItems() {
            const buyableParts = ALL_CODE_PARTS.filter(part => {
                return !gameData.collection.some(item => item.id === part.id);
            });

            if (buyableParts.length === 0) {
                buyableItemsList.innerHTML = '<p>–í—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ–±—Ä–∞–Ω—ã! üèÜ</p>';
            } else {
                buyableItemsList.innerHTML = '';
                const sortedBuyableParts = [...buyableParts].sort((a, b) => a.name.localeCompare(b.name));

                sortedBuyableParts.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'list-item';
                    div.innerHTML = `
                        <div class="list-item-main" id="shop-main-${item.id}">
                            <span class="list-item-name">${item.emoji} ${item.name}</span>
                            <div class="list-item-description" id="shop-desc-${item.id}">
                                ${item.description}
                            </div>
                        </div>
                        <button class="item-action-button buy-button" data-item-id="${item.id}">–ö—É–ø–∏—Ç—å (${PART_PRICE} üåü)</button>
                    `;
                    const buyButton = div.querySelector('.buy-button');
                    buyButton.disabled = gameData.experience < PART_PRICE;
                    buyButton.onclick = (event) => {
                        event.stopPropagation();
                        buyPart(item.id);
                    };
                    div.querySelector('.list-item-main').onclick = () => {
                        const descElement = document.getElementById(`shop-desc-${item.id}`);
                        if (descElement) {
                            descElement.classList.toggle('show');
                        }
                    };
                    buyableItemsList.appendChild(div);
                });
            }
        }

        function renderAchievements() {
            achievementsList.innerHTML = '';
            const allAchievements = [
                { id: 'collect_5_unique', name: '–ü–µ—Ä–≤–æ–æ—Ç–∫—Ä—ã–≤–∞—Ç–µ–ª—å', description: '–°–æ–±—Ä–∞—Ç—å 5 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö SQL-—Ñ—É–Ω–∫—Ü–∏–π', threshold: 5, type: 'unique_parts' },
                { id: 'collect_10_unique', name: '–Æ–Ω—ã–π –ë–∞–∑–∏—Å—Ç', description: '–°–æ–±—Ä–∞—Ç—å 10 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö SQL-—Ñ—É–Ω–∫—Ü–∏–π', threshold: 10, type: 'unique_parts' },
                { id: 'collect_20_unique', name: '–ú–∞—Å—Ç–µ—Ä –ó–∞–ø—Ä–æ—Å–æ–≤', description: '–°–æ–±—Ä–∞—Ç—å 20 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö SQL-—Ñ—É–Ω–∫—Ü–∏–π', threshold: 20, type: 'unique_parts' },
                { id: 'earn_50_xp', name: '–û–ø—ã—Ç–Ω—ã–π –ö–æ–¥–µ—Ä', description: '–ó–∞—Ä–∞–±–æ—Ç–∞—Ç—å 50 –æ–ø—ã—Ç–∞', threshold: 50, type: 'total_xp' },
                { id: 'sell_5_parts', name: '–¢–æ—Ä–≥–æ–≤–µ—Ü –î–∞–Ω–Ω—ã–º–∏', description: '–ü—Ä–æ–¥–∞—Ç—å 5 SQL-—Ñ—É–Ω–∫—Ü–∏–π', threshold: 5, type: 'parts_sold' }
            ];

            allAchievements.forEach(ach => {
                const isCompleted = gameData.achievements[ach.id] && gameData.achievements[ach.id].completed;
                const div = document.createElement('div');
                div.className = `achievement-item ${isCompleted ? 'completed' : ''}`;
                div.innerHTML = `
                    <div>
                        <strong>${ach.name}</strong><br>
                        <span>${ach.description}</span>
                    </div>
                    ${isCompleted ? '<span>&#10003; –ü–æ–ª—É—á–µ–Ω–æ!</span>' : ''}
                `;
                achievementsList.appendChild(div);
            });
        }

        function renderStats() {
            statsUniqueCount.textContent = gameData.collection.length;
            const totalParts = gameData.collection.reduce((sum, item) => sum + item.count, 0);
            statsTotalCount.textContent = totalParts;
            statsExperienceEarned.textContent = gameData.totalXpEarned;
            statsPartsSold.textContent = gameData.partsSold;
            statsPartsBought.textContent = gameData.partsBought;
        }

        // --- –õ–æ–≥–∏–∫–∞ –∏–≥—Ä—ã ---
        function addExperience(amount) {
            gameData.experience += amount;
            gameData.currentXp += amount;
            gameData.totalXpEarned += amount; // –û–±—â–∏–π –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –æ–ø—ã—Ç

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–æ–≤—ã—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è
            while (gameData.currentXp >= gameData.xpToNextLevel) {
                gameData.currentXp -= gameData.xpToNextLevel; // –û—Å—Ç–∞–≤—à–∏–π—Å—è –æ–ø—ã—Ç –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—Å—è –Ω–∞ –Ω–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å
                gameData.level++;
                gameData.xpToNextLevel = Math.floor(XP_PER_LEVEL_BASE * Math.pow(XP_PER_LEVEL_MULTIPLIER, gameData.level - 1));
                gameData.message = `–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ –£—Ä–æ–≤–Ω—è ${gameData.level}! üéâ`;
            }
            checkAchievements(); // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–ø—ã—Ç–∞
        }

        function checkAchievements() {
            const uniquePartsCount = gameData.collection.length;

            // –î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ "–ü–µ—Ä–≤–æ–æ—Ç–∫—Ä—ã–≤–∞—Ç–µ–ª—å"
            if (uniquePartsCount >= 5 && !gameData.achievements.collect_5_unique.completed) {
                gameData.achievements.collect_5_unique.completed = true;
                addExperience(gameData.achievements.collect_5_unique.reward);
                gameData.message = `–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ: "–ü–µ—Ä–≤–æ–æ—Ç–∫—Ä—ã–≤–∞—Ç–µ–ª—å" –ø–æ–ª—É—á–µ–Ω–æ! (+${gameData.achievements.collect_5_unique.reward} üåü)`;
            }
            // –î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ "–Æ–Ω—ã–π –ë–∞–∑–∏—Å—Ç"
            if (uniquePartsCount >= 10 && !gameData.achievements.collect_10_unique.completed) {
                gameData.achievements.collect_10_unique.completed = true;
                addExperience(gameData.achievements.collect_10_unique.reward);
                gameData.message = `–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ: "–Æ–Ω—ã–π –ë–∞–∑–∏—Å—Ç" –ø–æ–ª—É—á–µ–Ω–æ! (+${gameData.achievements.collect_10_unique.reward} üåü)`;
            }
            // –î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ "–ú–∞—Å—Ç–µ—Ä –ó–∞–ø—Ä–æ—Å–æ–≤"
            if (uniquePartsCount >= 20 && !gameData.achievements.collect_20_unique.completed) {
                gameData.achievements.collect_20_unique.completed = true;
                addExperience(gameData.achievements.collect_20_unique.reward);
                gameData.message = `–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ: "–ú–∞—Å—Ç–µ—Ä –ó–∞–ø—Ä–æ—Å–æ–≤" –ø–æ–ª—É—á–µ–Ω–æ! (+${gameData.achievements.collect_20_unique.reward} üåü)`;
            }

            // –î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ "–û–ø—ã—Ç–Ω—ã–π –ö–æ–¥–µ—Ä"
            if (gameData.totalXpEarned >= 50 && !gameData.achievements.earn_50_xp.completed) {
                gameData.achievements.earn_50_xp.completed = true;
                addExperience(gameData.achievements.earn_50_xp.reward);
                gameData.message = `–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ: "–û–ø—ã—Ç–Ω—ã–π –ö–æ–¥–µ—Ä" –ø–æ–ª—É—á–µ–Ω–æ! (+${gameData.achievements.earn_50_xp.reward} üåü)`;
            }

            // –î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ "–¢–æ—Ä–≥–æ–≤–µ—Ü –î–∞–Ω–Ω—ã–º–∏"
            if (gameData.partsSold >= 5 && !gameData.achievements.sell_5_parts.completed) {
                gameData.achievements.sell_5_parts.completed = true;
                addExperience(gameData.achievements.sell_5_parts.reward);
                gameData.message = `–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ: "–¢–æ—Ä–≥–æ–≤–µ—Ü –î–∞–Ω–Ω—ã–º–∏" –ø–æ–ª—É—á–µ–Ω–æ! (+${gameData.achievements.sell_5_parts.reward} üåü)`;
            }
        }


        // –õ–æ–≥–∏–∫–∞ –ø–æ–∫—É–ø–∫–∏
        function buyPart(partId) {
            if (gameData.experience < PART_PRICE) {
                gameData.message = '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–ø—ã—Ç–∞ –¥–ª—è –ø–æ–∫—É–ø–∫–∏! üö´';
                updateUI();
                return;
            }

            const partToBuy = ALL_CODE_PARTS.find(part => part.id === partId);
            if (!partToBuy) {
                gameData.message = '–û—à–∏–±–∫–∞: —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.';
                updateUI();
                return;
            }

            const existingPart = gameData.collection.find(item => item.id === partId);

            if (!existingPart) { // –ï—Å–ª–∏ –Ω–µ—Ç –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ (–ø–æ–∫—É–ø–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—É—é)
                gameData.collection.push({...partToBuy, count: 1});
            } else { // –ï—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å, —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫
                existingPart.count++;
            }

            gameData.experience -= PART_PRICE;
            gameData.partsBought++; // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            gameData.message = `–í—ã –∫—É–ø–∏–ª–∏ ${partToBuy.emoji} ${partToBuy.name}! (-${PART_PRICE} üåü)`;
            updateUI();
        }

        // –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–¥–∞–∂–∏
        function sellPart(partId) {
            const existingPartIndex = gameData.collection.findIndex(item => item.id === partId);

            if (existingPartIndex !== -1) {
                const soldPart = gameData.collection[existingPartIndex];

                if (soldPart.count > 1) {
                    soldPart.count--;
                    gameData.message = `–í—ã –ø—Ä–æ–¥–∞–ª–∏ ${soldPart.emoji} ${soldPart.name}! –¢–µ–ø–µ—Ä—å —É –≤–∞—Å –∏—Ö ${soldPart.count}. (+${PART_PRICE} üåü)`;
                } else {
                    gameData.collection.splice(existingPartIndex, 1);
                    gameData.message = `–í—ã –ø—Ä–æ–¥–∞–ª–∏ –ø–æ—Å–ª–µ–¥–Ω—é—é ${soldPart.emoji} ${soldPart.name}! (+${PART_PRICE} üåü)`;
                }
                gameData.experience += PART_PRICE;
                gameData.partsSold++; // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            } else {
                gameData.message = '–û—à–∏–±–∫–∞: —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–µ—Ç –≤ –≤–∞—à–µ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏.';
            }
            updateUI();
        }

        // --- –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å ---
        function checkDailyBonusAvailability() {
            const now = Date.now();
            if (now - gameData.lastDailyBonusClaim >= DAILY_BONUS_COOLDOWN_MS) {
                dailyBonusMessage.textContent = `–í–∞—à –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å –≥–æ—Ç–æ–≤! –ü–æ–ª—É—á–∏—Ç–µ ${DAILY_BONUS_AMOUNT} –æ–ø—ã—Ç–∞.`;
                claimDailyBonusButton.disabled = false;
            } else {
                const timeLeftMs = DAILY_BONUS_COOLDOWN_MS - (now - gameData.lastDailyBonusClaim);
                const hours = Math.floor(timeLeftMs / (1000 * 60 * 60));
                const minutes = Math.floor((timeLeftMs % (1000 * 60 * 60)) / (1000 * 60));
                dailyBonusMessage.textContent = `–°–ª–µ–¥—É—é—â–∏–π –±–æ–Ω—É—Å —á–µ—Ä–µ–∑: ${hours}—á ${minutes}–º`;
                claimDailyBonusButton.disabled = true;
            }
        }

        function claimDailyBonus() {
            const now = Date.now();
            if (now - gameData.lastDailyBonusClaim >= DAILY_BONUS_COOLDOWN_MS) {
                addExperience(DAILY_BONUS_AMOUNT);
                gameData.lastDailyBonusClaim = now;
                gameData.message = `–í—ã –ø–æ–ª—É—á–∏–ª–∏ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å! (+${DAILY_BONUS_AMOUNT} üåü)`;
                updateUI();
            } else {
                gameData.message = '–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å –ø–æ–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.';
                updateUI();
            }
        }


        // --- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –∫–Ω–æ–ø–æ–∫ ---
        collectButton.addEventListener('click', () => {
            const randomIndex = Math.floor(Math.random() * ALL_CODE_PARTS.length);
            const foundPart = ALL_CODE_PARTS[randomIndex];

            const existingPart = gameData.collection.find(item => item.id === foundPart.id);

            if (!existingPart) {
                gameData.collection.push({...foundPart, count: 1});
                addExperience(1); // –î–æ–±–∞–≤–ª—è–µ–º 1 –æ–ø—ã—Ç –∑–∞ –Ω–æ–≤—É—é –Ω–∞—Ö–æ–¥–∫—É
                gameData.message = `–í—ã –Ω–∞—à–ª–∏ –Ω–æ–≤—É—é SQL-—Ñ—É–Ω–∫—Ü–∏—é! üéâ ${foundPart.emoji} ${foundPart.name} (+1 üåü)`;
            } else {
                existingPart.count++;
                addExperience(1); // –î–æ–±–∞–≤–ª—è–µ–º 1 –æ–ø—ã—Ç –¥–∞–∂–µ –∑–∞ –¥—É–±–ª–∏–∫–∞—Ç
                gameData.message = `–í—ã –Ω–∞—à–ª–∏ ${foundPart.emoji} ${foundPart.name} (—É–∂–µ –µ—Å—Ç—å)! –¢–µ–ø–µ—Ä—å —É –≤–∞—Å –∏—Ö ${existingPart.count}. (+1 üåü)`;
            }
            updateUI();
        });

        viewCollectionButton.addEventListener('click', () => {
            gameData.currentView = 'collection';
            gameData.message = '–í–∞—à–∞ –∫–æ–ª–ª–µ–∫—Ü–∏—è SQL-—Ñ—É–Ω–∫—Ü–∏–π:';
            updateUI();
        });

        createButton.addEventListener('click', () => {
            gameData.currentView = 'create';
            gameData.message = '–ß—Ç–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–æ–∑–¥–∞—Ç—å?';
            updateUI();
        });

        shopButton.addEventListener('click', () => {
            gameData.currentView = 'shop';
            gameData.message = '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–∞–≥–∞–∑–∏–Ω!';
            updateUI();
        });

        dailyBonusButton.addEventListener('click', () => {
            gameData.currentView = 'daily_bonus';
            updateUI(); // –í—ã–∑–æ–≤ updateUI –∑–¥–µ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç checkDailyBonusAvailability
        });
        claimDailyBonusButton.addEventListener('click', claimDailyBonus);

        achievementsButton.addEventListener('click', () => {
            gameData.currentView = 'achievements';
            gameData.message = '–í–∞—à–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:';
            updateUI();
        });

        statsButton.addEventListener('click', () => {
            gameData.currentView = 'stats';
            gameData.message = '–í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:';
            updateUI();
        });


        // –ö–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥"
        backFromCollectionButton.addEventListener('click', () => {
            gameData.currentView = 'main';
            gameData.message = '–ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ —Å–æ–±–∏—Ä–∞—Ç—å –∏–ª–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å!';
            updateUI();
        });

        backFromCreateButton.addEventListener('click', () => {
            gameData.currentView = 'main';
            gameData.message = '–ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ —Å–æ–±–∏—Ä–∞—Ç—å –∏–ª–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å!';
            updateUI();
        });

        backFromShopButton.addEventListener('click', () => {
            gameData.currentView = 'main';
            gameData.message = '–ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è!';
            updateUI();
        });

        backFromDailyBonusButton.addEventListener('click', () => {
            gameData.currentView = 'main';
            gameData.message = '–ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è!';
            updateUI();
        });

        backFromAchievementsButton.addEventListener('click', () => {
            gameData.currentView = 'main';
            gameData.message = '–ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è!';
            updateUI();
        });

        backFromStatsButton.addEventListener('click', () => {
            gameData.currentView = 'main';
            gameData.message = '–ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è!';
            updateUI();
        });

        // –ö–Ω–æ–ø–∫–∞ —Å–±—Ä–æ—Å–∞ –∏–≥—Ä—ã
        resetGameButton.addEventListener('click', () => {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É –∑–∞–Ω–æ–≤–æ? –í—Å–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã!')) {
                localStorage.removeItem('coderGameData'); // –£–¥–∞–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ localStorage
                // –°–±—Ä–æ—Å gameData –¥–æ –Ω–∞—á–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
                gameData = {
                    message: "–ò–≥—Ä–∞ –Ω–∞—á–∞—Ç–∞ –∑–∞–Ω–æ–≤–æ! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!",
                    collection: [],
                    experience: 0,
                    level: 1,
                    xpToNextLevel: 100,
                    currentXp: 0,
                    totalXpEarned: 0,
                    partsSold: 0,
                    partsBought: 0,
                    lastDailyBonusClaim: 0,
                    achievements: {
                        collect_5_unique: { completed: false, reward: 10 },
                        collect_10_unique: { completed: false, reward: 20 },
                        collect_20_unique: { completed: false, reward: 40 },
                        earn_50_xp: { completed: false, reward: 15 },
                        sell_5_parts: { completed: false, reward: 10 }
                    },
                    currentView: 'main'
                };
                updateUI(); // –û–±–Ω–æ–≤–ª—è–µ–º UI –ø–æ—Å–ª–µ —Å–±—Ä–æ—Å–∞
                // –î–ª—è Telegram Mini App –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –Ω–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –∏–ª–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞
                setTimeout(() => {
                    if (window.Telegram && window.Telegram.WebApp) {
                         // –ï—Å–ª–∏ –µ—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–∫—Ä—ã—Ç—å, —Ç–æ –∑–∞–∫—Ä—ã–≤–∞–µ–º
                         // Telegram.WebApp.close();
                         location.reload(); // –ò–ª–∏ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
                    } else {
                        location.reload(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
                    }
                }, 100);
            }
        });


        // --- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã ---
        function saveGameData() {
            localStorage.setItem('coderGameData', JSON.stringify(gameData));
            // console.log('Game data saved!');
        }

        function loadGameData() {
            const savedData = localStorage.getItem('coderGameData');
            if (savedData) {
                const loadedGameData = JSON.parse(savedData);

                // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç –≤ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                gameData.experience = loadedGameData.experience !== undefined ? loadedGameData.experience : 0;
                gameData.level = loadedGameData.level !== undefined ? loadedGameData.level : 1;
                gameData.xpToNextLevel = loadedGameData.xpToNextLevel !== undefined ? loadedGameData.xpToNextLevel : 100;
                gameData.currentXp = loadedGameData.currentXp !== undefined ? loadedGameData.currentXp : 0;
                gameData.totalXpEarned = loadedGameData.totalXpEarned !== undefined ? loadedGameData.totalXpEarned : 0;
                gameData.partsSold = loadedGameData.partsSold !== undefined ? loadedGameData.partsSold : 0;
                gameData.partsBought = loadedGameData.partsBought !== undefined ? loadedGameData.partsBought : 0;
                gameData.lastDailyBonusClaim = loadedGameData.lastDailyBonusClaim !== undefined ? loadedGameData.lastDailyBonusClaim : 0;
                gameData.currentView = loadedGameData.currentView || 'main';

                // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π —Å —É—á–µ—Ç–æ–º –Ω–æ–≤—ã—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π, –µ—Å–ª–∏ –æ–Ω–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã
                for (const achId in gameData.achievements) {
                    if (loadedGameData.achievements && loadedGameData.achievements[achId]) {
                        gameData.achievements[achId].completed = loadedGameData.achievements[achId].completed;
                    }
                }

                // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–∏: —É–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ —á–∞—Å—Ç–∏ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –≤ ALL_CODE_PARTS
                // –∏ —á—Ç–æ —É –Ω–∏—Ö –µ—Å—Ç—å —Å–≤–æ–π—Å—Ç–≤–æ count
                gameData.collection = (loadedGameData.collection || []).map(item => {
                    const fullItem = ALL_CODE_PARTS.find(part => part.id === item.id);
                    return fullItem ? {...fullItem, count: item.count || 1} : null;
                }).filter(Boolean); // –§–∏–ª—å—Ç—Ä—É–µ–º null-–∑–Ω–∞—á–µ–Ω–∏—è, –µ—Å–ª–∏ —Å—Ç–∞—Ä—ã–µ ID –Ω–µ –Ω–∞—à–ª–∏—Å—å
            }
        }

        // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ ---
        loadGameData();
        updateUI(); // –ü–µ—Ä–≤–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI

        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω–æ –Ω–µ –±—ã–ª–æ –∏–∑–º–µ–Ω–µ–Ω–æ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        if (gameData.currentView === 'main') {
            gameMessageElement.textContent = `–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –æ–±—Ä–∞—Ç–Ω–æ! –£ –≤–∞—Å ${gameData.experience} üåü`;
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
        setInterval(saveGameData, 5000);
    </script>
</body>
</html>
