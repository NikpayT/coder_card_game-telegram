<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò–≥—Ä–∞: –°–±–æ—Ä—â–∏–∫ –ö–æ–¥–∞ SQL</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
            color: #333;
            text-align: center;
        }
        .game-container {
            max-width: 600px;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .header-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            font-size: 1.1em;
            color: #555;
        }
        .message {
            margin-bottom: 15px;
            font-size: 1.1em;
            color: #333;
        }
        .buttons-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }
        button {
            padding: 10px 15px;
            font-size: 1em;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background-color: #007bff;
            color: white;
            transition: background-color 0.2s;
            flex-grow: 1;
            min-width: 120px;
        }
        button:hover {
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .reset-button { /* –°—Ç–∏–ª—å –¥–ª—è –∫–Ω–æ–ø–∫–∏ —Å–±—Ä–æ—Å–∞ */
            background-color: #dc3545; /* –ö—Ä–∞—Å–Ω—ã–π —Ü–≤–µ—Ç */
            margin-top: 15px;
        }
        .reset-button:hover {
            background-color: #c82333;
        }

        /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å–ø–∏—Å–∫–æ–≤ (–∫–æ–ª–ª–µ–∫—Ü–∏—è, –º–∞–≥–∞–∑–∏–Ω) */
        .list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            margin-bottom: 10px;
            background-color: #e2e6ea;
            border-radius: 4px;
            text-align: left;
            position: relative;
            flex-wrap: wrap;
        }
        .list-item-main {
            flex-grow: 1;
            padding-right: 10px;
            cursor: pointer; /* –î–ª—è –ø–æ–∫–∞–∑–∞/—Å–∫—Ä—ã—Ç–∏—è –æ–ø–∏—Å–∞–Ω–∏—è */
        }
        .list-item-description {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            width: 100%;
        }
        .list-item-description.show {
            max-height: 100px;
        }
        .item-action-button {
            padding: 5px 10px;
            font-size: 0.8em;
            margin-left: 10px;
            flex-shrink: 0;
        }
        .buy-button {
            background-color: #28a745; /* –ó–µ–ª–µ–Ω—ã–π */
        }
        .buy-button:hover {
            background-color: #218838;
        }
        .sell-button {
            background-color: #dc3545; /* –ö—Ä–∞—Å–Ω—ã–π */
        }
        .sell-button:hover {
            background-color: #c82333;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header-info">
            <span id="experienceDisplay">–û–ø—ã—Ç: 0 üåü</span>
            <span id="gameMessage" class="message">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∏–≥—Ä—É "–°–±–æ—Ä—â–∏–∫ SQL-—Ñ—É–Ω–∫—Ü–∏–π"! üöÄ</span>
        </div>

        <div class="buttons-container">
            <button id="collectButton">–ù–∞–π—Ç–∏ SQL-—Ñ—É–Ω–∫—Ü–∏—é üîç</button>
            <button id="viewCollectionButton">–ú–æ—è –∫–æ–ª–ª–µ–∫—Ü–∏—è SQL üéí</button>
            <button id="createButton">–°–æ–∑–¥–∞—Ç—å SQL-–∑–∞–ø—Ä–æ—Å üí°</button>
            <button id="shopButton">–ú–∞–≥–∞–∑–∏–Ω üí∞</button>
        </div>

        <div id="collectionDisplay" style="display: none; margin-top: 20px;">
            <h3 id="collectionHeader">–ú–æ—è –∫–æ–ª–ª–µ–∫—Ü–∏—è SQL: (0/55)</h3> <div id="collectionList">
                <p>–ü–æ–∫–∞ –Ω–∏—á–µ–≥–æ –Ω–µ—Ç...</p>
            </div>
            <button id="backFromCollection">–ù–∞–∑–∞–¥</button>
        </div>

        <div id="createPanel" style="display: none; margin-top: 20px;">
            <h3>–°–æ–∑–¥–∞–Ω–∏–µ SQL-–∑–∞–ø—Ä–æ—Å–∞:</h3>
            <div id="availableParts">
                <p>–°–Ω–∞—á–∞–ª–∞ —Å–æ–±–µ—Ä–∏—Ç–µ SQL-—Ñ—É–Ω–∫—Ü–∏–∏!</p>
            </div>
            <button id="backFromCreate">–ù–∞–∑–∞–¥</button>
        </div>

        <div id="shopPanel" style="display: none; margin-top: 20px;">
            <h3>–ú–∞–≥–∞–∑–∏–Ω SQL-—Ñ—É–Ω–∫—Ü–∏–π:</h3>
            <div id="buyableItemsList">
                <p>–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ–±—Ä–∞–Ω—ã!</p>
            </div>
            <button id="backFromShop" style="margin-top: 20px;">–ù–∞–∑–∞–¥</button>
        </div>

        <button id="resetGameButton" class="reset-button" style="display: none;">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É –∑–∞–Ω–æ–≤–æ (—É–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ)</button>
    </div> <div style="font-size: 0.8em; color: #888; margin-top: 20px;">
        –í–µ—Ä—Å–∏—è: <span id="gameVersion">0.3.0</span> </div>

    <script src="game_data.js"></script>

    <script>
        // –ò–≥—Ä–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        let gameData = {
            message: "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∏–≥—Ä—É!",
            collection: [], // –¢–µ–ø–µ—Ä—å —ç–ª–µ–º–µ–Ω—Ç—ã –±—É–¥—É—Ç {id: 'sql_select', count: 1}
            experience: 0,
            currentView: 'main' // 'main', 'collection', 'create', 'shop'
        };

        const PART_PRICE = 1; // –°—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–∫—É–ø–∫–∏/–ø—Ä–æ–¥–∞–∂–∏ –æ–¥–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏

        // DOM-—ç–ª–µ–º–µ–Ω—Ç—ã
        const gameMessageElement = document.getElementById('gameMessage');
        const experienceDisplay = document.getElementById('experienceDisplay');
        const buttonsContainer = document.querySelector('.buttons-container');
        const collectButton = document.getElementById('collectButton');
        const viewCollectionButton = document.getElementById('viewCollectionButton');
        const createButton = document.getElementById('createButton');
        const shopButton = document.getElementById('shopButton');

        const collectionDisplay = document.getElementById('collectionDisplay');
        const collectionHeader = document.getElementById('collectionHeader'); // –ù–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç
        const collectionList = document.getElementById('collectionList');
        const backFromCollectionButton = document.getElementById('backFromCollection');

        const createPanel = document.getElementById('createPanel');
        const availablePartsDiv = document.getElementById('availableParts');
        const backFromCreateButton = document.getElementById('backFromCreate');

        const shopPanel = document.getElementById('shopPanel');
        const buyableItemsList = document.getElementById('buyableItemsList'); // –ó–∞–º–µ–Ω–∏–ª–∏ sellableItemsList
        const backFromShopButton = document.getElementById('backFromShop');

        const resetGameButton = document.getElementById('resetGameButton'); // –ù–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞


        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App SDK
        if (window.Telegram && window.Telegram.WebApp) {
            Telegram.WebApp.ready();
            Telegram.WebApp.expand();
            console.log('Telegram WebApp initialized.');
        } else {
            console.warn('Telegram WebApp script not loaded or not in Telegram environment.');
        }

        // --- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ UI –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ ---
        function updateUI() {
            gameMessageElement.textContent = gameData.message;
            experienceDisplay.textContent = `–û–ø—ã—Ç: ${gameData.experience} üåü`;

            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –ø–∞–Ω–µ–ª–∏
            buttonsContainer.style.display = 'none';
            collectionDisplay.style.display = 'none';
            createPanel.style.display = 'none';
            shopPanel.style.display = 'none';
            resetGameButton.style.display = 'none'; // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —Å–±—Ä–æ—Å–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é –ø–∞–Ω–µ–ª—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ –≤–∏–¥–∞
            if (gameData.currentView === 'main') {
                buttonsContainer.style.display = 'flex';
                resetGameButton.style.display = 'block'; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞ –≥–ª–∞–≤–Ω–æ–π
            } else if (gameData.currentView === 'collection') {
                collectionDisplay.style.display = 'block';
                renderCollection();
            } else if (gameData.currentView === 'create') {
                createPanel.style.display = 'block';
                renderCreatePanel();
            } else if (gameData.currentView === 'shop') {
                shopPanel.style.display = 'block';
                renderShopItems(); // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –¥–ª—è –º–∞–≥–∞–∑–∏–Ω–∞
            }
        }

        function renderCollection() {
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
            const uniquePartsCount = gameData.collection.length;
            const totalPartsCount = ALL_CODE_PARTS.length;
            collectionHeader.textContent = `–ú–æ—è –∫–æ–ª–ª–µ–∫—Ü–∏—è SQL: (${uniquePartsCount}/${totalPartsCount})`;

            if (gameData.collection.length === 0) {
                collectionList.innerHTML = '<p>–ü–æ–∫–∞ –Ω–∏—á–µ–≥–æ –Ω–µ—Ç...</p>';
            } else {
                collectionList.innerHTML = '';
                // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∫–æ–ª–ª–µ–∫—Ü–∏—é –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
                const sortedCollection = [...gameData.collection].sort((a, b) => a.name.localeCompare(b.name));

                sortedCollection.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'list-item'; // –û–±—â–∏–π –∫–ª–∞—Å—Å –¥–ª—è —Å–ø–∏—Å–∫–æ–≤
                    div.innerHTML = `
                        <div class="list-item-main" id="coll-main-${item.id}">
                            ${item.emoji} ${item.name} (x${item.count}) <div class="list-item-description" id="coll-desc-${item.id}">
                                ${item.description}
                            </div>
                        </div>
                        <button class="item-action-button sell-button" data-item-id="${item.id}">–ü—Ä–æ–¥–∞—Ç—å (${PART_PRICE} üåü)</button>
                    `;
                    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ü—Ä–æ–¥–∞—Ç—å"
                    div.querySelector('.sell-button').onclick = (event) => {
                        event.stopPropagation(); // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–µ –∫–ª–∏–∫–∞ –Ω–∞ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º div
                        sellPart(item.id);
                    };
                    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø–æ–∫–∞–∑–∞/—Å–∫—Ä—ã—Ç–∏—è –æ–ø–∏—Å–∞–Ω–∏—è –ø–æ –∫–ª–∏–∫—É –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç
                    div.querySelector('.list-item-main').onclick = () => {
                        const descElement = document.getElementById(`coll-desc-${item.id}`);
                        if (descElement) {
                            descElement.classList.toggle('show');
                        }
                    };
                    collectionList.appendChild(div);
                });
            }
        }

        function renderCreatePanel() {
            if (gameData.collection.length === 0) {
                availablePartsDiv.innerHTML = '<p>–°–Ω–∞—á–∞–ª–∞ —Å–æ–±–µ—Ä–∏—Ç–µ SQL-—Ñ—É–Ω–∫—Ü–∏–∏, —á—Ç–æ–±—ã —á—Ç–æ-—Ç–æ —Å–æ–∑–¥–∞—Ç—å!</p>';
            } else {
                availablePartsDiv.innerHTML = '<p>–í—ã–±–µ—Ä–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ –≤–∞—à–µ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –¥–ª—è "—Å–±–æ—Ä–∫–∏":</p>';
                availablePartsDiv.innerHTML = '';

                // –ü–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –∫–Ω–æ–ø–∫–∏, –±–µ–∑ –ª–æ–≥–∏–∫–∏ —Å–±–æ—Ä–∫–∏
                gameData.collection.forEach(item => {
                    const button = document.createElement('button');
                    button.textContent = `${item.emoji} ${item.name} (x${item.count})`;
                    button.onclick = () => selectPartToCreate(item.id);
                    availablePartsDiv.appendChild(button);
                });
                if (gameData.collection.length > 0) {
                     const createFinalButton = document.createElement('button');
                     createFinalButton.textContent = '‚ö°Ô∏è –°–æ–±—Ä–∞—Ç—å SQL-–∑–∞–ø—Ä–æ—Å (–ø–æ–∫–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)';
                     createFinalButton.style.marginTop = '10px';
                     createFinalButton.onclick = () => {
                         gameData.message = '–í—ã –ø—ã—Ç–∞–ª–∏—Å—å —Å–æ–±—Ä–∞—Ç—å SQL-–∑–∞–ø—Ä–æ—Å! üõ†Ô∏è (—Ñ—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)';
                         updateUI();
                     };
                     availablePartsDiv.appendChild(createFinalButton);
                }
            }
        }

        function renderShopItems() {
            // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ —á–∞—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã—Ö –ù–ï–¢ –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –∏–≥—Ä–æ–∫–∞
            const buyableParts = ALL_CODE_PARTS.filter(part => {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ç–∞–∫–æ–π ID –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ (–Ω–µ –≤–∞–∂–Ω–æ, —Å–∫–æ–ª—å–∫–æ –∏—Ö)
                return !gameData.collection.some(item => item.id === part.id);
            });

            if (buyableParts.length === 0) {
                buyableItemsList.innerHTML = '<p>–í—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ–±—Ä–∞–Ω—ã! üèÜ</p>';
            } else {
                buyableItemsList.innerHTML = '';
                // –°–æ—Ä—Ç–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫ –¥–ª—è –º–∞–≥–∞–∑–∏–Ω–∞
                const sortedBuyableParts = [...buyableParts].sort((a, b) => a.name.localeCompare(b.name));

                sortedBuyableParts.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'list-item';
                    div.innerHTML = `
                        <div class="list-item-main" id="shop-main-${item.id}">
                            ${item.emoji} ${item.name}
                            <div class="list-item-description" id="shop-desc-${item.id}">
                                ${item.description}
                            </div>
                        </div>
                        <button class="item-action-button buy-button" data-item-id="${item.id}">–ö—É–ø–∏—Ç—å (${PART_PRICE} üåü)</button>
                    `;
                    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∫–Ω–æ–ø–∫–∏ "–ö—É–ø–∏—Ç—å"
                    const buyButton = div.querySelector('.buy-button');
                    buyButton.disabled = gameData.experience < PART_PRICE; // –ï—Å–ª–∏ –æ–ø—ã—Ç–∞ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç, –∫–Ω–æ–ø–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞
                    buyButton.onclick = (event) => {
                        event.stopPropagation();
                        buyPart(item.id);
                    };
                    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø–æ–∫–∞–∑–∞/—Å–∫—Ä—ã—Ç–∏—è –æ–ø–∏—Å–∞–Ω–∏—è –ø–æ –∫–ª–∏–∫—É
                    div.querySelector('.list-item-main').onclick = () => {
                        const descElement = document.getElementById(`shop-desc-${item.id}`);
                        if (descElement) {
                            descElement.classList.toggle('show');
                        }
                    };
                    buyableItemsList.appendChild(div);
                });
            }
        }


        // --- –õ–æ–≥–∏–∫–∞ –∏–≥—Ä—ã ---
        function selectPartToCreate(partId) {
            const selectedPart = ALL_CODE_PARTS.find(p => p.id === partId); // –ò—â–µ–º –≤ –æ–±—â–µ–º —Å–ø–∏—Å–∫–µ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è
            if (selectedPart) {
                gameData.message = `–í—ã –≤—ã–±—Ä–∞–ª–∏ "${selectedPart.name}" –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è! ü§î (–Ω—É–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–ª—è "—Å–±–æ—Ä–∫–∏")`;
                updateUI();
            }
        }

        // –õ–æ–≥–∏–∫–∞ –ø–æ–∫—É–ø–∫–∏
        function buyPart(partId) {
            if (gameData.experience < PART_PRICE) {
                gameData.message = '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–ø—ã—Ç–∞ –¥–ª—è –ø–æ–∫—É–ø–∫–∏! üö´';
                updateUI();
                return;
            }

            const partToBuy = ALL_CODE_PARTS.find(part => part.id === partId);
            if (!partToBuy) {
                gameData.message = '–û—à–∏–±–∫–∞: —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.';
                updateUI();
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Ç–∞–∫–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
            const existingPartIndex = gameData.collection.findIndex(item => item.id === partId);

            if (existingPartIndex === -1) { // –ï—Å–ª–∏ –Ω–µ—Ç –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ (–ø–æ–∫—É–ø–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—É—é)
                gameData.collection.push({...partToBuy, count: 1});
            } else { // –ï—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å, —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫
                gameData.collection[existingPartIndex].count++;
            }

            gameData.experience -= PART_PRICE;
            gameData.message = `–í—ã –∫—É–ø–∏–ª–∏ ${partToBuy.emoji} ${partToBuy.name}! (-${PART_PRICE} üåü)`;
            updateUI();
        }

        // –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–¥–∞–∂–∏
        function sellPart(partId) {
            const existingPartIndex = gameData.collection.findIndex(item => item.id === partId);

            if (existingPartIndex !== -1) {
                const soldPart = gameData.collection[existingPartIndex];

                if (soldPart.count > 1) { // –ï—Å–ª–∏ —Ç–∞–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π –Ω–µ—Å–∫–æ–ª—å–∫–æ, —É–º–µ–Ω—å—à–∞–µ–º —Å—á–µ—Ç—á–∏–∫
                    soldPart.count--;
                    gameData.message = `–í—ã –ø—Ä–æ–¥–∞–ª–∏ ${soldPart.emoji} ${soldPart.name}! –¢–µ–ø–µ—Ä—å —É –≤–∞—Å –∏—Ö ${soldPart.count}. (+${PART_PRICE} üåü)`;
                } else { // –ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –æ–¥–Ω–∞, —É–¥–∞–ª—è–µ–º –µ—ë –∏–∑ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
                    gameData.collection.splice(existingPartIndex, 1);
                    gameData.message = `–í—ã –ø—Ä–æ–¥–∞–ª–∏ –ø–æ—Å–ª–µ–¥–Ω—é—é ${soldPart.emoji} ${soldPart.name}! (+${PART_PRICE} üåü)`;
                }
                gameData.experience += PART_PRICE;
            } else {
                gameData.message = '–û—à–∏–±–∫–∞: —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–µ—Ç –≤ –≤–∞—à–µ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏.';
            }
            updateUI();
        }

        // --- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –∫–Ω–æ–ø–æ–∫ ---
        collectButton.addEventListener('click', () => {
            const randomIndex = Math.floor(Math.random() * ALL_CODE_PARTS.length);
            const foundPart = ALL_CODE_PARTS[randomIndex];

            const existingPartIndex = gameData.collection.findIndex(item => item.id === foundPart.id);

            if (existingPartIndex === -1) {
                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é —É–Ω–∏–∫–∞–ª—å–Ω—É—é —á–∞—Å—Ç—å —Å count = 1
                gameData.collection.push({...foundPart, count: 1});
                gameData.experience += 1;
                gameData.message = `–í—ã –Ω–∞—à–ª–∏ –Ω–æ–≤—É—é SQL-—Ñ—É–Ω–∫—Ü–∏—é! üéâ ${foundPart.emoji} ${foundPart.name} (+1 üåü)`;
            } else {
                // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —á–∞—Å—Ç–∏
                gameData.collection[existingPartIndex].count++;
                gameData.experience += 1;
                gameData.message = `–í—ã –Ω–∞—à–ª–∏ ${foundPart.emoji} ${foundPart.name} (—É–∂–µ –µ—Å—Ç—å)! –¢–µ–ø–µ—Ä—å —É –≤–∞—Å –∏—Ö ${gameData.collection[existingPartIndex].count}. (+1 üåü)`;
            }
            updateUI();
        });

        viewCollectionButton.addEventListener('click', () => {
            gameData.currentView = 'collection';
            gameData.message = '–í–∞—à–∞ –∫–æ–ª–ª–µ–∫—Ü–∏—è SQL-—Ñ—É–Ω–∫—Ü–∏–π:';
            updateUI();
        });

        createButton.addEventListener('click', () => {
            gameData.currentView = 'create';
            gameData.message = '–ß—Ç–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–æ–∑–¥–∞—Ç—å?';
            updateUI();
        });

        shopButton.addEventListener('click', () => {
            gameData.currentView = 'shop';
            gameData.message = '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–∞–≥–∞–∑–∏–Ω!';
            updateUI();
        });

        // –ö–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥"
        backFromCollectionButton.addEventListener('click', () => {
            gameData.currentView = 'main';
            gameData.message = '–ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ —Å–æ–±–∏—Ä–∞—Ç—å –∏–ª–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å!';
            updateUI();
        });

        backFromCreateButton.addEventListener('click', () => {
            gameData.currentView = 'main';
            gameData.message = '–ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ —Å–æ–±–∏—Ä–∞—Ç—å –∏–ª–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å!';
            updateUI();
        });

        backFromShopButton.addEventListener('click', () => {
            gameData.currentView = 'main';
            gameData.message = '–ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è!';
            updateUI();
        });

        resetGameButton.addEventListener('click', () => {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É –∑–∞–Ω–æ–≤–æ? –í—Å–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã!')) {
                localStorage.removeItem('coderGameData');
                gameData = { // –°–±—Ä–æ—Å –¥–æ –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
                    message: "–ò–≥—Ä–∞ –Ω–∞—á–∞—Ç–∞ –∑–∞–Ω–æ–≤–æ! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!",
                    collection: [],
                    experience:
