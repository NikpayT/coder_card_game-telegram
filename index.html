<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò–≥—Ä–∞: –°–±–æ—Ä—â–∏–∫ –ö–æ–¥–∞ SQL</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
            color: #333;
            text-align: center;
        }
        .game-container {
            max-width: 600px;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .message {
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        .buttons-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }
        button {
            padding: 10px 15px;
            font-size: 1em;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background-color: #007bff;
            color: white;
            transition: background-color 0.2s;
        }
        button:hover {
            background-color: #0056b3;
        }
        .collection-item {
            display: block;
            padding: 8px;
            margin-bottom: 10px;
            background-color: #e2e6ea;
            border-radius: 4px;
            text-align: left;
            position: relative;
            cursor: pointer;
        }
        .collection-item-description {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .collection-item-description.show {
            max-height: 100px; /* –î–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –¥–ª—è —Ç–µ–∫—Å—Ç–∞ */
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="message" id="gameMessage">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∏–≥—Ä—É "–°–±–æ—Ä—â–∏–∫ SQL-—Ñ—É–Ω–∫—Ü–∏–π"! üöÄ –°–æ–±–µ—Ä–∏—Ç–µ —Å–≤–æ—é –ø–µ—Ä–≤—É—é —á–∞—Å—Ç—å!</div>
        <div class="buttons-container">
            <button id="collectButton">–ù–∞–π—Ç–∏ SQL-—Ñ—É–Ω–∫—Ü–∏—é üîç</button>
            <button id="viewCollectionButton">–ú–æ—è –∫–æ–ª–ª–µ–∫—Ü–∏—è SQL üéí</button>
            <button id="createButton">–°–æ–∑–¥–∞—Ç—å SQL-–∑–∞–ø—Ä–æ—Å üí°</button>
        </div>

        <div id="collectionDisplay" style="display: none; margin-top: 20px;">
            <h3>–ú–æ—è –∫–æ–ª–ª–µ–∫—Ü–∏—è SQL:</h3>
            <div id="collectionList">
                <p>–ü–æ–∫–∞ –Ω–∏—á–µ–≥–æ –Ω–µ—Ç...</p>
            </div>
            <button id="backFromCollection">–ù–∞–∑–∞–¥</button>
        </div>

        <div id="createPanel" style="display: none; margin-top: 20px;">
            <h3>–°–æ–∑–¥–∞–Ω–∏–µ SQL-–∑–∞–ø—Ä–æ—Å–∞:</h3>
            <div id="availableParts">
                <p>–°–Ω–∞—á–∞–ª–∞ —Å–æ–±–µ—Ä–∏—Ç–µ SQL-—Ñ—É–Ω–∫—Ü–∏–∏!</p>
            </div>
            <button id="backFromCreate">–ù–∞–∑–∞–¥</button>
        </div>
    </div> <div style="font-size: 0.8em; color: #888; margin-top: 20px;">
        –í–µ—Ä—Å–∏—è: <span id="gameVersion">0.1.1</span> </div>

    <script src="game_data.js"></script>

    <script>
        let gameData = {
            message: "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∏–≥—Ä—É!",
            collection: [],
            currentView: 'main'
        };

        const gameMessageElement = document.getElementById('gameMessage');
        const buttonsContainer = document.querySelector('.buttons-container');
        const collectButton = document.getElementById('collectButton');
        const viewCollectionButton = document.getElementById('viewCollectionButton');
        const createButton = document.getElementById('createButton');
        const collectionDisplay = document.getElementById('collectionDisplay');
        const collectionList = document.getElementById('collectionList');
        const backFromCollectionButton = document.getElementById('backFromCollection');
        const createPanel = document.getElementById('createPanel');
        const availablePartsDiv = document.getElementById('availableParts');
        const backFromCreateButton = document.getElementById('backFromCreate');


        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App SDK
        if (window.Telegram && window.Telegram.WebApp) {
            Telegram.WebApp.ready();
            Telegram.WebApp.expand();
            console.log('Telegram WebApp initialized.');
        } else {
            console.warn('Telegram WebApp script not loaded or not in Telegram environment.');
        }

        function updateUI() {
            gameMessageElement.textContent = gameData.message;

            if (gameData.currentView === 'main') {
                buttonsContainer.style.display = 'flex';
                collectionDisplay.style.display = 'none';
                createPanel.style.display = 'none';
            } else if (gameData.currentView === 'collection') {
                buttonsContainer.style.display = 'none';
                collectionDisplay.style.display = 'block';
                createPanel.style.display = 'none';
                renderCollection();
            } else if (gameData.currentView === 'create') {
                buttonsContainer.style.display = 'none';
                collectionDisplay.style.display = 'none';
                createPanel.style.display = 'block';
                renderCreatePanel();
            }
        }

        function renderCollection() {
            if (gameData.collection.length === 0) {
                collectionList.innerHTML = '<p>–ü–æ–∫–∞ –Ω–∏—á–µ–≥–æ –Ω–µ—Ç...</p>';
            } else {
                collectionList.innerHTML = '';
                gameData.collection.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'collection-item';
                    div.innerHTML = `
                        <div>${item.emoji} ${item.name}</div>
                        <div class="collection-item-description" id="desc-${item.id}">
                            ${item.description}
                        </div>
                    `;
                    div.onclick = () => {
                        const descElement = document.getElementById(`desc-${item.id}`);
                        if (descElement) {
                            descElement.classList.toggle('show');
                        }
                    };
                    collectionList.appendChild(div);
                });
            }
        }

        function renderCreatePanel() {
            if (gameData.collection.length === 0) {
                availablePartsDiv.innerHTML = '<p>–°–Ω–∞—á–∞–ª–∞ —Å–æ–±–µ—Ä–∏—Ç–µ SQL-—Ñ—É–Ω–∫—Ü–∏–∏, —á—Ç–æ–±—ã —á—Ç–æ-—Ç–æ —Å–æ–∑–¥–∞—Ç—å!</p>';
            } else {
                availablePartsDiv.innerHTML = '<p>–í—ã–±–µ—Ä–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ –≤–∞—à–µ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –¥–ª—è "—Å–±–æ—Ä–∫–∏":</p>';
                availablePartsDiv.innerHTML = '';

                gameData.collection.forEach(item => {
                    const button = document.createElement('button');
                    button.textContent = `${item.emoji} ${item.name}`;
                    button.onclick = () => selectPartToCreate(item.id);
                    availablePartsDiv.appendChild(button);
                });
                if (gameData.collection.length > 0) {
                     const createFinalButton = document.createElement('button');
                     createFinalButton.textContent = '‚ö°Ô∏è –°–æ–±—Ä–∞—Ç—å SQL-–∑–∞–ø—Ä–æ—Å (–ø–æ–∫–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)';
                     createFinalButton.style.marginTop = '10px';
                     createFinalButton.onclick = () => {
                         gameData.message = '–í—ã –ø—ã—Ç–∞–ª–∏—Å—å —Å–æ–±—Ä–∞—Ç—å SQL-–∑–∞–ø—Ä–æ—Å! üõ†Ô∏è (—Ñ—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)';
                         updateUI();
                     };
                     availablePartsDiv.appendChild(createFinalButton);
                }
            }
        }

        function selectPartToCreate(partId) {
            const selectedPart = gameData.collection.find(p => p.id === partId);
            if (selectedPart) {
                gameData.message = `–í—ã –≤—ã–±—Ä–∞–ª–∏ "${selectedPart.name}" –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è! ü§î (–Ω—É–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–ª—è "—Å–±–æ—Ä–∫–∏")`;
                updateUI();
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –∫–Ω–æ–ø–æ–∫
        collectButton.addEventListener('click', () => {
            const randomIndex = Math.floor(Math.random() * ALL_CODE_PARTS.length);
            const foundPart = ALL_CODE_PARTS[randomIndex];

            if (!gameData.collection.some(item => item.id === foundPart.id)) {
                gameData.collection.push({...foundPart});
                gameData.message = `–í—ã –Ω–∞—à–ª–∏ –Ω–æ–≤—É—é SQL-—Ñ—É–Ω–∫—Ü–∏—é! üéâ ${foundPart.emoji} ${foundPart.name}`;
            } else {
                gameData.message = `–í—ã –Ω–∞—à–ª–∏ ${foundPart.emoji} ${foundPart.name}, –Ω–æ –æ–Ω–∞ —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å! –ü–æ–∏—â–∏—Ç–µ —á—Ç–æ-—Ç–æ –¥—Ä—É–≥–æ–µ... üòÖ`;
            }
            updateUI();
        });

        viewCollectionButton.addEventListener('click', () => {
            gameData.currentView = 'collection';
            gameData.message = '–í–∞—à–∞ –∫–æ–ª–ª–µ–∫—Ü–∏—è SQL-—Ñ—É–Ω–∫—Ü–∏–π:';
            updateUI();
        });

        backFromCollectionButton.addEventListener('click', () => {
            gameData.currentView = 'main';
            gameData.message = '–ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ —Å–æ–±–∏—Ä–∞—Ç—å –∏–ª–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å!';
            updateUI();
        });

        createButton.addEventListener('click', () => {
            gameData.currentView = 'create';
            gameData.message = '–ß—Ç–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–æ–∑–¥–∞—Ç—å?';
            updateUI();
        });

        backFromCreateButton.addEventListener('click', () => {
            gameData.currentView = 'main';
            gameData.message = '–ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ —Å–æ–±–∏—Ä–∞—Ç—å –∏–ª–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å!';
            updateUI();
        });

        // –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        updateUI();

        // –ü—Ä–∏–º–µ—Ä —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è (localStorage)
        function saveGameData() {
            localStorage.setItem('coderGameData', JSON.stringify(gameData));
        }

        function loadGameData() {
            const savedData = localStorage.getItem('coderGameData');
            if (savedData) {
                const loadedGameData = JSON.parse(savedData);
                loadedGameData.collection = loadedGameData.collection.map(item => {
                    const fullItem = ALL_CODE_PARTS.find(part => part.id === item.id);
                    return fullItem ? {...fullItem} : item;
                });
                gameData = loadedGameData;
            }
        }

        loadGameData();
        updateUI();

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
        setInterval(saveGameData, 5000);
    </script>
</body>
</html>
