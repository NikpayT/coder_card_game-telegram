<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL Code Collector Game</title>
    <style>
        /* --- CSS Variables for easy theme changes --- */
        :root {
            --primary-color: #4CAF50; /* Green for main actions */
            --primary-hover-color: #45a049;
            --secondary-color: #2196F3; /* Blue for info/secondary actions */
            --secondary-hover-color: #1976D2;
            --danger-color: #f44336; /* Red for destructive actions */
            --danger-hover-color: #d32f2f;
            --background-color: #e0f2f7; /* Light blue-grey background */
            --card-background: #ffffff;
            --text-color: #333333;
            --light-text-color: #757575;
            --border-radius: 12px;
            --shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            --xp-progress-color: #4CAF50;
            --energy-color: #FFD700; /* Gold for energy */
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--background-color);
            color: var(--text-color);
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            box-sizing: border-box;
            line-height: 1.6;
        }

        .game-container {
            max-width: 650px; /* Slightly wider for more content */
            width: 100%;
            margin: 20px auto;
            padding: 25px;
            background-color: var(--card-background);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            animation: fadeIn 0.5s ease-out;
            box-sizing: border-box;
            position: relative; /* –î–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω */
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes foundItem {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }

        .header-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap; /* –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
            margin-bottom: 20px;
            font-size: 1.1em;
            color: var(--light-text-color);
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        .header-left {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        .header-right {
            text-align: right;
            margin-top: 10px; /* –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
            width: 100%;
        }
        @media (min-width: 480px) { /* –î–ª—è –¥–µ—Å–∫—Ç–æ–ø–æ–≤ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–µ–º –≤ —Å—Ç—Ä–æ–∫—É */
            .header-right {
                width: auto;
                margin-top: 0;
            }
        }

        .header-info #experienceDisplay,
        .header-info #levelDisplay {
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 5px;
        }
        .header-info #energyDisplay {
            font-weight: bold;
            color: var(--energy-color);
            margin-bottom: 5px;
        }

        .progress-bar-container {
            background-color: #e0e0e0;
            border-radius: 5px;
            height: 8px;
            margin-top: 5px;
            overflow: hidden;
            width: 150px; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∏—Ä–∏–Ω–∞ */
        }
        .progress-bar {
            height: 100%;
            width: 0%;
            background-color: var(--xp-progress-color);
            border-radius: 5px;
            transition: width 0.3s ease-out;
        }

        .message {
            margin-bottom: 20px;
            font-size: 1.2em;
            font-weight: 500;
            color: var(--text-color);
            min-height: 30px; /* –ß—Ç–æ–±—ã –Ω–µ –ø—Ä—ã–≥–∞–ª–æ –ø—Ä–∏ —Å–º–µ–Ω–µ —Ç–µ–∫—Å—Ç–∞ */
        }

        .buttons-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); /* –£–≤–µ–ª–∏—á–∏–ª minmax */
            gap: 12px;
            margin-bottom: 20px;
        }

        button {
            padding: 12px 18px;
            font-size: 1em;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            background-color: var(--primary-color);
            color: white;
            transition: background-color 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
            font-weight: 600;
        }
        button:hover {
            background-color: var(--primary-hover-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        button:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }

        .secondary-button {
            background-color: var(--secondary-color);
        }
        .secondary-button:hover {
            background-color: var(--secondary-hover-color);
        }

        .danger-button {
            background-color: var(--danger-color);
        }
        .danger-button:hover {
            background-color: var(--danger-hover-color);
        }

        /* General list item styling */
        .list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin-bottom: 10px;
            background-color: #f7f7f7;
            border-radius: 8px;
            border: 1px solid #eee;
            text-align: left;
            flex-wrap: wrap;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            transition: background-color 0.2s ease;
        }
        .list-item:hover {
            background-color: #f0f0f0;
        }

        .list-item-main {
            flex-grow: 1;
            padding-right: 15px;
            cursor: pointer;
        }
        .list-item-name {
            font-weight: 600;
            font-size: 1.05em;
            color: var(--text-color);
        }
        .list-item-description {
            font-size: 0.85em;
            color: var(--light-text-color);
            margin-top: 5px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
            opacity: 0;
            width: 100%;
            white-space: pre-wrap; /* –î–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–∏–º–µ—Ä–æ–≤ –∫–æ–¥–∞ —Å –ø–µ—Ä–µ–Ω–æ—Å–∞–º–∏ */
        }
        .list-item-description.show {
            max-height: 200px; /* –£–≤–µ–ª–∏—á–∏–ª –¥–ª—è –ø—Ä–∏–º–µ—Ä–æ–≤ –∫–æ–¥–∞ */
            opacity: 1;
        }

        .item-action-button {
            padding: 8px 12px;
            font-size: 0.85em;
            border-radius: 6px;
            margin-left: 10px;
            flex-shrink: 0;
            box-shadow: none;
        }
        .item-action-button:hover {
             transform: translateY(-1px);
             box-shadow: 0 1px 3px rgba(0, 0, 0, 0.15);
        }

        .buy-button { background-color: var(--secondary-color); }
        .buy-button:hover { background-color: var(--secondary-hover-color); }
        .sell-button { background-color: var(--danger-color); }
        .sell-button:hover { background-color: var(--danger-hover-color); }

        h3 {
            color: var(--primary-color);
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.4em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        h4 {
            color: var(--secondary-color);
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        #collectionHeader {
            color: var(--secondary-color);
            font-size: 1.2em;
            font-weight: 600;
        }

        /* Achievements Panel */
        #achievementsPanel, #dailyBonusPanel, #statsPanel, #marketPanel, #boostersPanel, #projectPanel, #historyPanel {
            background-color: #f7f7f7;
            padding: 15px;
            border-radius: var(--border-radius);
            margin-top: 20px;
            text-align: left;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }
        .achievement-item {
            padding: 10px;
            margin-bottom: 8px;
            border-bottom: 1px dashed #eee;
            color: var(--text-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .achievement-item:last-child {
            border-bottom: none;
        }
        .achievement-item.completed {
            color: var(--primary-color);
            font-weight: 600;
            background-color: #e8f5e9;
            border-radius: 5px;
        }
        .achievement-item.completed span {
            font-size: 1.2em;
        }

        /* Daily Bonus Panel */
        #dailyBonusPanel h3 { color: #ff9800; }
        #claimDailyBonusButton { background-color: #ffc107; color: #333; }
        #claimDailyBonusButton:hover { background-color: #ffb300; }

        /* Stats Panel */
        #statsPanel p { margin: 5px 0; font-size: 0.95em; color: var(--light-text-color); }
        #statsPanel strong { color: var(--text-color); }

        /* Market Panel */
        #marketPanel h3 { color: #8bc34a; }
        .market-item .list-item-name { color: #8bc34a; } /* Color for rare functions */
        .market-buy-button { background-color: #8bc34a; } /* Green for market buy */
        .market-buy-button:hover { background-color: #7cb342; }

        /* Boosters Panel */
        #boostersPanel h3 { color: #9c27b0; }
        .booster-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin-bottom: 10px;
            background-color: #f3e5f5; /* Light purple */
            border-radius: 8px;
            border: 1px solid #e1bee7;
        }
        .booster-item button { background-color: #9c27b0; }
        .booster-item button:hover { background-color: #7b1fa2; }

        /* Project Panel */
        #projectPanel h3 { color: #607d8b; } /* Blue-grey for projects */
        .project-item {
            border: 1px solid #b0bec5;
            background-color: #eceff1;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            text-align: left;
        }
        .project-item.completed {
            background-color: #dcedc8; /* Light green for completed */
            border-color: #aed581;
        }
        .project-item strong {
            color: #607d8b;
        }
        .project-item ul {
            list-style: none;
            padding-left: 0;
            margin-top: 10px;
        }
        .project-item li {
            margin-bottom: 5px;
            color: #546e7a;
        }
        .project-item .requirement-met {
            color: var(--primary-color);
            font-weight: bold;
        }
        .project-action-button {
            margin-top: 10px;
            width: auto; /* –î–ª—è –∫–Ω–æ–ø–∫–∏ "–ó–∞–≤–µ—Ä—à–∏—Ç—å" */
        }

        /* History Panel */
        #historyPanel h3 { color: #009688; }
        .history-entry {
            padding: 8px 0;
            border-bottom: 1px dotted #e0e0e0;
            font-size: 0.9em;
            color: var(--light-text-color);
        }
        .history-entry:last-child { border-bottom: none; }

        /* Version Info */
        .version-info {
            font-size: 0.75em;
            color: #aaaaaa;
            margin-top: 25px;
        }

        /* Modal for detailed info */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 100; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
            animation: fadeInModal 0.3s ease-out;
        }
        .modal-content {
            background-color: #fefefe;
            margin: 10% auto; /* 10% from the top and centered */
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            width: 80%; /* Could be more responsive */
            max-width: 500px;
            position: relative;
            animation: slideInModal 0.3s ease-out;
            text-align: left;
        }
        @keyframes fadeInModal { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideInModal { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            top: 10px;
            right: 20px;
        }
        .close-button:hover,
        .close-button:focus {
            color: #333;
            text-decoration: none;
            cursor: pointer;
        }
        .modal-content h4 {
            color: var(--primary-color);
            margin-top: 0;
            font-size: 1.5em;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
            text-align: center;
        }
        .modal-content p {
            margin-bottom: 10px;
        }
        .modal-content strong {
            color: var(--text-color);
        }
        .modal-content pre {
            background-color: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            overflow-x: auto;
            white-space: pre-wrap; /* –î–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞ –¥–ª–∏–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫ */
            word-break: break-all; /* –î–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –≤—ã—Ö–æ–¥–∞ –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã */
            font-family: 'Consolas', 'Courier New', monospace;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header-info">
            <div class="header-left">
                <span id="experienceDisplay">–û–ø—ã—Ç: 0 üåü</span>
                <span id="levelDisplay">–£—Ä–æ–≤–µ–Ω—å: 1 (0/100 XP)</span>
                <div class="progress-bar-container">
                    <div id="levelProgressBar" class="progress-bar"></div>
                </div>
            </div>
            <div class="header-right">
                <span id="energyDisplay">–≠–Ω–µ—Ä–≥–∏—è: 10/10 ‚ö°Ô∏è</span>
                <p class="message" id="gameMessage">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∏–≥—Ä—É "–°–±–æ—Ä—â–∏–∫ SQL-—Ñ—É–Ω–∫—Ü–∏–π"! üöÄ</p>
            </div>
        </div>

        <div class="buttons-container" id="mainButtons">
            <button id="collectButton">–ù–∞–π—Ç–∏ SQL-—Ñ—É–Ω–∫—Ü–∏—é üîç (1 ‚ö°Ô∏è)</button>
            <button id="viewCollectionButton" class="secondary-button">–ú–æ—è –∫–æ–ª–ª–µ–∫—Ü–∏—è SQL üéí</button>
            <button id="shopButton" class="secondary-button">–ú–∞–≥–∞–∑–∏–Ω üí∞</button>
            <button id="dailyBonusButton" class="secondary-button">–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å üéÅ</button>
            <button id="achievementsButton" class="secondary-button">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è üèÜ</button>
            <button id="statsButton" class="secondary-button">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ üìà</button>
            <button id="projectBoardButton" class="secondary-button">–î–æ—Å–∫–∞ –ü—Ä–æ–µ–∫—Ç–æ–≤ üìã</button>
            <button id="boostersButton" class="secondary-button">–ë—É—Å—Ç–µ—Ä—ã üöÄ</button>
            <button id="historyButton" class="secondary-button">–ò—Å—Ç–æ—Ä–∏—è üìú</button>
        </div>

        <div id="collectionDisplay" style="display: none; margin-top: 20px;">
            <h3 id="collectionHeader">–ú–æ—è –∫–æ–ª–ª–µ–∫—Ü–∏—è SQL: (0/55)</h3>
            <div id="collectionList">
                <p>–ü–æ–∫–∞ –Ω–∏—á–µ–≥–æ –Ω–µ—Ç...</p>
            </div>
            <button id="backFromCollection" class="secondary-button">–ù–∞–∑–∞–¥</button>
        </div>

        <div id="createPanel" style="display: none; margin-top: 20px;">
            <h3>–°–æ–∑–¥–∞–Ω–∏–µ SQL-–∑–∞–ø—Ä–æ—Å–∞:</h3>
            <div id="availableParts">
                <p>–ó–¥–µ—Å—å –≤—ã —Å–º–æ–∂–µ—Ç–µ –æ–±—ä–µ–¥–∏–Ω—è—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤! (–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)</p>
            </div>
            <button id="backFromCreate" class="secondary-button">–ù–∞–∑–∞–¥</button>
        </div>

        <div id="shopPanel" style="display: none; margin-top: 20px;">
            <h3>–ú–∞–≥–∞–∑–∏–Ω SQL-—Ñ—É–Ω–∫—Ü–∏–π:</h3>
            <div id="buyableItemsList">
                <p>–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ–±—Ä–∞–Ω—ã!</p>
            </div>
            <button id="backFromShop" class="secondary-button">–ù–∞–∑–∞–¥</button>
        </div>

        <div id="marketPanel" style="display: none; margin-top: 20px;">
            <h3>–†—ã–Ω–æ–∫ –†–µ–¥–∫–∏—Ö –§—É–Ω–∫—Ü–∏–π:</h3>
            <p>–ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ –∫—É–ø–∏—Ç—å —Ä–µ–¥–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ —Å–ª–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –æ–±—ã—á–Ω—ã–º –ø–æ–∏—Å–∫–æ–º.</p>
            <div id="marketItemsList">
                <p>–ù–∞ —Ä—ã–Ω–∫–µ –ø–æ–∫–∞ –Ω–µ—Ç —Ä–µ–¥–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π.</p>
            </div>
            <button id="backFromMarket" class="secondary-button">–ù–∞–∑–∞–¥</button>
        </div>

        <div id="dailyBonusPanel" style="display: none; margin-top: 20px;">
            <h3>–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å!</h3>
            <p id="dailyBonusMessage">–ó–∞–±–µ—Ä–∏—Ç–µ —Å–≤–æ–π –±–æ–Ω—É—Å!</p>
            <button id="claimDailyBonusButton" class="secondary-button">–ó–∞–±—Ä–∞—Ç—å –±–æ–Ω—É—Å (5 üåü)</button>
            <button id="backFromDailyBonus" class="secondary-button" style="margin-top: 10px;">–ù–∞–∑–∞–¥</button>
        </div>

        <div id="achievementsPanel" style="display: none; margin-top: 20px;">
            <h3>–í–∞—à–∏ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h3>
            <div id="achievementsList">
                </div>
            <button id="backFromAchievements" class="secondary-button">–ù–∞–∑–∞–¥</button>
        </div>

        <div id="statsPanel" style="display: none; margin-top: 20px;">
            <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
            <p>–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –Ω–∞–π–¥–µ–Ω–æ: <strong id="statsUniqueCount">0</strong></p>
            <p>–í—Å–µ–≥–æ —Ñ—É–Ω–∫—Ü–∏–π (–≤–∫–ª—é—á–∞—è –¥—É–±–ª–∏–∫–∞—Ç—ã): <strong id="statsTotalCount">0</strong></p>
            <p>–û–ø—ã—Ç–∞ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: <strong id="statsExperienceEarned">0</strong></p>
            <p>–§—É–Ω–∫—Ü–∏–π –ø—Ä–æ–¥–∞–Ω–æ: <strong id="statsPartsSold">0</strong></p>
            <p>–§—É–Ω–∫—Ü–∏–π –∫—É–ø–ª–µ–Ω–æ: <strong id="statsPartsBought">0</strong></p>
            <button id="backFromStats" class="secondary-button">–ù–∞–∑–∞–¥</button>
        </div>

        <div id="projectPanel" style="display: none; margin-top: 20px;">
            <h3>–î–æ—Å–∫–∞ –ü—Ä–æ–µ–∫—Ç–æ–≤</h3>
            <p>–í—ã–ø–æ–ª–Ω—è–π—Ç–µ –ø—Ä–æ–µ–∫—Ç—ã, —Å–æ–±–∏—Ä–∞—è –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ SQL-—Ñ—É–Ω–∫—Ü–∏–∏, —á—Ç–æ–±—ã –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å –±–æ–ª—å—à–∏–µ –Ω–∞–≥—Ä–∞–¥—ã!</p>
            <div id="projectList">
                <p>–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤.</p>
            </div>
            <button id="backFromProjectBoard" class="secondary-button">–ù–∞–∑–∞–¥</button>
        </div>

        <div id="boostersPanel" style="display: none; margin-top: 20px;">
            <h3>–ë—É—Å—Ç–µ—Ä—ã –∏ –£–ª—É—á—à–µ–Ω–∏—è</h3>
            <p>–£–ª—É—á—à–∏—Ç–µ —Å–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å! (–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –±—É—Å—Ç–µ—Ä–æ–≤ 5 –º–∏–Ω—É—Ç)</p>
            <div id="boosterList">
                </div>
            <button id="backFromBoosters" class="secondary-button">–ù–∞–∑–∞–¥</button>
        </div>

        <div id="historyPanel" style="display: none; margin-top: 20px;">
            <h3>–ò—Å—Ç–æ—Ä–∏—è –î–µ–π—Å—Ç–≤–∏–π</h3>
            <div id="historyLog">
                <p>–í–∞—à–∞ –∏—Å—Ç–æ—Ä–∏—è –¥–µ–π—Å—Ç–≤–∏–π –ø—É—Å—Ç–∞.</p>
            </div>
            <button id="backFromHistory" class="secondary-button">–ù–∞–∑–∞–¥</button>
        </div>


        <button id="resetGameButton" class="danger-button" style="margin-top: 25px;">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É –∑–∞–Ω–æ–≤–æ (—É–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ)</button>
    </div> <div class="version-info">
        –í–µ—Ä—Å–∏—è: <span id="gameVersion">0.5.0</span>
    </div>

    <div id="partDetailModal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="closePartDetailModal">&times;</span>
            <h4 id="modalPartName">–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏</h4>
            <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> <span id="modalPartDescription"></span></p>
            <p><strong>–¢–∏–ø:</strong> <span id="modalPartType"></span></p>
            <p><strong>–ü—Ä–∏–º–µ—Ä:</strong></p>
            <pre id="modalPartExample"><code></code></pre>
            <p><strong>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏:</strong> <span id="modalPartCount"></span></p>
            <button id="modalSellButton" class="item-action-button sell-button" style="display:none;">–ü—Ä–æ–¥–∞—Ç—å (1 üåü)</button>
        </div>
    </div>


    <script src="game_data.js"></script>

    <script>
        // --- –ò–≥—Ä–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ ---
        let gameData = {
            message: "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∏–≥—Ä—É!",
            collection: [], // [{id: 'sql_select', count: 1}]
            experience: 0,
            level: 1,
            xpToNextLevel: 100,
            currentXp: 0, // –û–ø—ã—Ç –Ω–∞ —Ç–µ–∫—É—â–µ–º —É—Ä–æ–≤–Ω–µ
            totalXpEarned: 0, // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–≥–æ –æ–ø—ã—Ç–∞ –∑–∞ –≤—Å–µ –≤—Ä–µ–º—è
            partsSold: 0,
            partsBought: 0,
            lastDailyBonusClaim: 0, // Timestamp –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –±–æ–Ω—É—Å–∞
            energy: 10,
            maxEnergy: 10,
            energyRecoveryRate: 1, // 1 —ç–Ω–µ—Ä–≥–∏—è –≤ 1 –º–∏–Ω—É—Ç—É
            lastEnergyRecovery: Date.now(),
            activeBoosters: [], // [{id: 'xp_boost', endsAt: timestamp}]
            history: [], // [{timestamp: Date.now(), message: "–ù–∞–π–¥–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è X"}]
            achievements: { // –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
                collect_5_unique: { completed: false, reward: 10 },
                collect_10_unique: { completed: false, reward: 20 },
                collect_20_unique: { completed: false, reward: 40 },
                collect_all_unique: { completed: false, reward: 100 }, // –ù–æ–≤–æ–µ
                earn_50_xp: { completed: false, reward: 15 },
                earn_200_xp: { completed: false, reward: 50 }, // –ù–æ–≤–æ–µ
                sell_5_parts: { completed: false, reward: 10 },
                buy_5_parts: { completed: false, reward: 10 }, // –ù–æ–≤–æ–µ
                complete_1_project: { completed: false, reward: 25 }, // –ù–æ–≤–æ–µ
            },
            projects: [ // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã
                { id: 'proj_basic_select', name: '–ë–∞–∑–æ–≤–∞—è –≤—ã–±–æ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö', description: '–ò–∑–≤–ª–µ—á—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã Customers.', requirements: ['sql_select', 'sql_from'], completed: false, reward_xp: 20 },
                { id: 'proj_filtered_select', name: '–í—ã–±–æ—Ä–∫–∞ —Å —Ñ–∏–ª—å—Ç—Ä–æ–º', description: '–ù–∞–π—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç—ã –¥–æ—Ä–æ–∂–µ 50.', requirements: ['sql_select', 'sql_from', 'sql_where'], completed: false, reward_xp: 35 },
                { id: 'proj_insert_data', name: '–í—Å—Ç–∞–≤–∫–∞ –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏', description: '–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Ç–∞–±–ª–∏—Ü—É.', requirements: ['sql_insert_into', 'sql_values'], completed: false, reward_xp: 25 },
                { id: 'proj_update_record', name: '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏', description: '–ò–∑–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∑–∞–ø–∏—Å–∏.', requirements: ['sql_update', 'sql_set', 'sql_where'], completed: false, reward_xp: 30 },
                { id: 'proj_delete_record', name: '–£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏', description: '–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å –∏–∑ —Ç–∞–±–ª–∏—Ü—ã.', requirements: ['sql_delete_from', 'sql_where'], completed: false, reward_xp: 20 },
                { id: 'proj_table_join', name: '–û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü', description: '–°–æ–µ–¥–∏–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ Customers –∏ Orders.', requirements: ['sql_select', 'sql_from', 'sql_join', 'sql_on'], completed: false, reward_xp: 50 },
                { id: 'proj_create_simple_table', name: '–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–π —Ç–∞–±–ª–∏—Ü—ã', description: '–°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É —Å ID –∏ –∏–º–µ–Ω–µ–º.', requirements: ['sql_create_table', 'sql_int', 'sql_varchar'], completed: false, reward_xp: 40 },
                { id: 'proj_count_records', name: '–ü–æ–¥—Å—á–µ—Ç –∑–∞–ø–∏—Å–µ–π', description: '–ü–æ—Å—á–∏—Ç–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –≤ —Ç–∞–±–ª–∏—Ü–µ.', requirements: ['sql_select', 'sql_count', 'sql_from'], completed: false, reward_xp: 20 },
                { id: 'proj_aggregate_data', name: '–ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö', description: '–í—ã—á–∏—Å–ª–∏—Ç—å —Å—Ä–µ–¥–Ω—é—é —Ü–µ–Ω—É –ø—Ä–æ–¥—É–∫—Ç–æ–≤, —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.', requirements: ['sql_select', 'sql_avg', 'sql_group_by'], completed: false, reward_xp: 45 }
            ],
            currentView: 'main' // 'main', 'collection', 'create', 'shop', 'daily_bonus', 'achievements', 'stats', 'market', 'boosters', 'projects', 'history'
        };

        // --- –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏–≥—Ä—ã ---
        const PART_PRICE = 1; // –°—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–∫—É–ø–∫–∏/–ø—Ä–æ–¥–∞–∂–∏ –æ–¥–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
        const XP_PER_LEVEL_BASE = 100;
        const XP_PER_LEVEL_MULTIPLIER = 1.2;
        const DAILY_BONUS_AMOUNT = 5;
        const DAILY_BONUS_COOLDOWN_MS = 24 * 60 * 60 * 1000; // 24 —á–∞—Å–∞
        const ENERGY_CONSUMPTION_PER_FIND = 1;
        const ENERGY_RECOVERY_INTERVAL_MS = 60 * 1000; // 1 –º–∏–Ω—É—Ç–∞

        // –¢–∏–ø—ã —Ä–µ–¥–∫–æ—Å—Ç–∏ (–¥–ª—è —Ä—ã–Ω–∫–∞ –∏ –±—É—Å—Ç–µ—Ä–æ–≤)
        const RARITIES = {
            common: { chance: 0.5, price: 1 },
            uncommon: { chance: 0.3, price: 3 },
            rare: { chance: 0.15, price: 5 },
            epic: { chance: 0.04, price: 10 },
            legendary: { chance: 0.01, price: 20 }
        };

        // –ë—É—Å—Ç–µ—Ä—ã
        const BOOSTERS = [
            { id: 'xp_boost', name: '–ë—É—Å—Ç–µ—Ä –æ–ø—ã—Ç–∞ (x2)', description: '–£–¥–≤–æ–µ–Ω–Ω—ã–π –æ–ø—ã—Ç –∑–∞ –Ω–∞—Ö–æ–¥–∫–∏ –Ω–∞ 5 –º–∏–Ω—É—Ç.', cost: 5, duration: 5 * 60 * 1000, effect: { type: 'xp_multiplier', value: 2 } },
            { id: 'energy_boost', name: '–ë—É—Å—Ç–µ—Ä —ç–Ω–µ—Ä–≥–∏–∏', description: '–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ 5 —ç–Ω–µ—Ä–≥–∏–∏.', cost: 3, effect: { type: 'energy_refill', value: 5 } },
            { id: 'find_chance_boost', name: '–ë—É—Å—Ç–µ—Ä —É–¥–∞—á–∏ (+10% —Ä–µ–¥–∫–∏—Ö)', description: '–ü–æ–≤—ã—à–∞–µ—Ç —à–∞–Ω—Å –Ω–∞–π—Ç–∏ —Ä–µ–¥–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ 10% –Ω–∞ 5 –º–∏–Ω—É—Ç.', cost: 7, duration: 5 * 60 * 1000, effect: { type: 'rare_chance', value: 0.1 } }
        ];


        // --- DOM-—ç–ª–µ–º–µ–Ω—Ç—ã (–∫–µ—à–∏—Ä—É–µ–º –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏) ---
        const gameMessageElement = document.getElementById('gameMessage');
        const experienceDisplay = document.getElementById('experienceDisplay');
        const levelDisplay = document.getElementById('levelDisplay');
        const levelProgressBar = document.getElementById('levelProgressBar');
        const energyDisplay = document.getElementById('energyDisplay');
        const mainButtonsContainer = document.getElementById('mainButtons');

        const collectButton = document.getElementById('collectButton');
        const viewCollectionButton = document.getElementById('viewCollectionButton');
        const createButton = document.getElementById('createButton');
        const shopButton = document.getElementById('shopButton');
        const dailyBonusButton = document.getElementById('dailyBonusButton');
        const achievementsButton = document.getElementById('achievementsButton');
        const statsButton = document.getElementById('statsButton');
        const projectBoardButton = document.getElementById('projectBoardButton'); // New
        const boostersButton = document.getElementById('boostersButton'); // New
        const historyButton = document.getElementById('historyButton'); // New

        const collectionDisplay = document.getElementById('collectionDisplay');
        const collectionHeader = document.getElementById('collectionHeader');
        const collectionList = document.getElementById('collectionList');
        const backFromCollectionButton = document.getElementById('backFromCollection');

        const createPanel = document.getElementById('createPanel');
        const availablePartsDiv = document.getElementById('availableParts');
        const backFromCreateButton = document.getElementById('backFromCreate');

        const shopPanel = document.getElementById('shopPanel');
        const buyableItemsList = document.getElementById('buyableItemsList');
        const backFromShopButton = document.getElementById('backFromShop');

        const marketPanel = document.getElementById('marketPanel'); // New
        const marketItemsList = document.getElementById('marketItemsList'); // New
        const backFromMarketButton = document.getElementById('backFromMarket'); // New

        const dailyBonusPanel = document.getElementById('dailyBonusPanel');
        const dailyBonusMessage = document.getElementById('dailyBonusMessage');
        const claimDailyBonusButton = document.getElementById('claimDailyBonusButton');
        const backFromDailyBonusButton = document.getElementById('backFromDailyBonus');

        const achievementsPanel = document.getElementById('achievementsPanel');
        const achievementsList = document.getElementById('achievementsList');
        const backFromAchievementsButton = document.getElementById('backFromAchievements');

        const statsPanel = document.getElementById('statsPanel');
        const statsUniqueCount = document.getElementById('statsUniqueCount');
        const statsTotalCount = document.getElementById('statsTotalCount');
        const statsExperienceEarned = document.getElementById('statsExperienceEarned');
        const statsPartsSold = document.getElementById('statsPartsSold');
        const statsPartsBought = document.getElementById('statsPartsBought');
        const backFromStatsButton = document.getElementById('backFromStats');

        const projectPanel = document.getElementById('projectPanel'); // New
        const projectList = document.getElementById('projectList'); // New
        const backFromProjectBoardButton = document.getElementById('backFromProjectBoard'); // New

        const boostersPanel = document.getElementById('boostersPanel'); // New
        const boosterList = document.getElementById('boosterList'); // New
        const backFromBoostersButton = document.getElementById('backFromBoosters'); // New

        const historyPanel = document.getElementById('historyPanel'); // New
        const historyLog = document.getElementById('historyLog'); // New
        const backFromHistoryButton = document.getElementById('backFromHistory'); // New

        const resetGameButton = document.getElementById('resetGameButton');

        // Modal elements
        const partDetailModal = document.getElementById('partDetailModal');
        const closePartDetailModal = document.getElementById('closePartDetailModal');
        const modalPartName = document.getElementById('modalPartName');
        const modalPartDescription = document.getElementById('modalPartDescription');
        const modalPartType = document.getElementById('modalPartType');
        const modalPartExample = document.getElementById('modalPartExample');
        const modalPartCount = document.getElementById('modalPartCount');
        const modalSellButton = document.getElementById('modalSellButton'); // –ü—Ä–æ–¥–∞—Ç—å –∏–∑ –º–æ–¥–∞–ª–∫–∏


        // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App SDK ---
        if (window.Telegram && window.Telegram.WebApp) {
            Telegram.WebApp.ready();
            Telegram.WebApp.expand();
            console.log('Telegram WebApp initialized.');
        } else {
            console.warn('Telegram WebApp script not loaded or not in Telegram environment.');
        }

        // --- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ UI –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ ---
        function updateUI() {
            // –û–±—â–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã
            gameMessageElement.textContent = gameData.message;
            experienceDisplay.textContent = `–û–ø—ã—Ç: ${gameData.experience} üåü`;
            levelDisplay.textContent = `–£—Ä–æ–≤–µ–Ω—å: ${gameData.level} (${gameData.currentXp}/${gameData.xpToNextLevel} XP)`;
            const progressPercentage = (gameData.currentXp / gameData.xpToNextLevel) * 100;
            levelProgressBar.style.width = `${progressPercentage}%`;

            // –≠–Ω–µ—Ä–≥–∏—è
            updateEnergy(); // –û–±–Ω–æ–≤–ª—è–µ–º —ç–Ω–µ—Ä–≥–∏—é –ø–µ—Ä–µ–¥ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
            energyDisplay.textContent = `–≠–Ω–µ—Ä–≥–∏—è: ${gameData.energy}/${gameData.maxEnergy} ‚ö°Ô∏è`;

            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –ø–∞–Ω–µ–ª–∏
            const allPanels = [
                mainButtonsContainer, collectionDisplay, createPanel, shopPanel,
                dailyBonusPanel, achievementsPanel, statsPanel, projectPanel,
                boostersPanel, historyPanel, marketPanel, resetGameButton
            ];
            allPanels.forEach(panel => panel.style.display = 'none');

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é –ø–∞–Ω–µ–ª—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ –≤–∏–¥–∞
            switch (gameData.currentView) {
                case 'main':
                    mainButtonsContainer.style.display = 'grid';
                    resetGameButton.style.display = 'block';
                    checkDailyBonusAvailability();
                    break;
                case 'collection':
                    collectionDisplay.style.display = 'block';
                    renderCollection();
                    break;
                case 'create':
                    createPanel.style.display = 'block';
                    renderCreatePanel();
                    break;
                case 'shop':
                    shopPanel.style.display = 'block';
                    renderShopItems();
                    break;
                case 'market': // New
                    marketPanel.style.display = 'block';
                    renderMarketItems();
                    break;
                case 'daily_bonus':
                    dailyBonusPanel.style.display = 'block';
                    checkDailyBonusAvailability();
                    break;
                case 'achievements':
                    achievementsPanel.style.display = 'block';
                    renderAchievements();
                    break;
                case 'stats':
                    statsPanel.style.display = 'block';
                    renderStats();
                    break;
                case 'projects': // New
                    projectPanel.style.display = 'block';
                    renderProjects();
                    break;
                case 'boosters': // New
                    boostersPanel.style.display = 'block';
                    renderBoosters();
                    break;
                case 'history': // New
                    historyPanel.style.display = 'block';
                    renderHistory();
                    break;
            }

            // –ö–Ω–æ–ø–∫–∞ –ø–æ–∏—Å–∫–∞
            collectButton.disabled = gameData.energy < ENERGY_CONSUMPTION_PER_FIND;
        }

        // --- –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –ø–∞–Ω–µ–ª–µ–π ---
        function renderCollection() {
            const uniquePartsCount = gameData.collection.length;
            const totalPartsCount = ALL_CODE_PARTS.length;
            collectionHeader.textContent = `–ú–æ—è –∫–æ–ª–ª–µ–∫—Ü–∏—è SQL: (${uniquePartsCount}/${totalPartsCount})`;

            if (gameData.collection.length === 0) {
                collectionList.innerHTML = '<p>–ü–æ–∫–∞ –Ω–∏—á–µ–≥–æ –Ω–µ—Ç...</p>';
            } else {
                collectionList.innerHTML = '';
                const sortedCollection = [...gameData.collection].sort((a, b) => a.name.localeCompare(b.name));

                sortedCollection.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'list-item';
                    div.innerHTML = `
                        <div class="list-item-main">
                            <span class="list-item-name">${item.emoji} ${item.name} (x${item.count})</span>
                            <div class="list-item-description">
                                ${item.description}
                                ${item.example ? `<br><br><strong>–ü—Ä–∏–º–µ—Ä:</strong><pre><code>${item.example}</code></pre>` : ''}
                            </div>
                        </div>
                        <button class="item-action-button sell-button" data-item-id="${item.id}">–ü—Ä–æ–¥–∞—Ç—å (${PART_PRICE} üåü)</button>
                    `;
                    // Event listener for opening modal/expanding description
                    const mainContent = div.querySelector('.list-item-main');
                    mainContent.onclick = (event) => {
                         // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª –ª–∏ –∫–ª–∏–∫ –∏–º–µ–Ω–Ω–æ –ø–æ –∫–Ω–æ–ø–∫–µ "–ü—Ä–æ–¥–∞—Ç—å" –≤–Ω—É—Ç—Ä–∏ item-main
                        if (event.target.closest('.item-action-button')) {
                            return; // –ï—Å–ª–∏ –¥–∞, –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É
                        }
                        showPartDetails(item.id);
                    };

                    div.querySelector('.sell-button').onclick = (event) => {
                        event.stopPropagation(); // Prevent modal from opening
                        sellPart(item.id);
                    };
                    collectionList.appendChild(div);
                });
            }
        }

        function showPartDetails(partId) {
            const part = ALL_CODE_PARTS.find(p => p.id === partId);
            const collectedPart = gameData.collection.find(item => item.id === partId);

            if (part) {
                modalPartName.textContent = `${part.emoji} ${part.name}`;
                modalPartDescription.textContent = part.description;
                modalPartType.textContent = part.type;
                modalPartExample.querySelector('code').textContent = part.example || '–ü—Ä–∏–º–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.';
                modalPartCount.textContent = collectedPart ? collectedPart.count : 0;

                if (collectedPart && collectedPart.count > 0) {
                    modalSellButton.style.display = 'block';
                    // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
                    const oldSellButton = modalSellButton.cloneNode(true);
                    modalSellButton.parentNode.replaceChild(oldSellButton, modalSellButton);
                    const newSellButton = document.getElementById('modalSellButton'); // –ü–æ–ª—É—á–∞–µ–º –Ω–æ–≤—É—é —Å—Å—ã–ª–∫—É
                    newSellButton.onclick = () => {
                        sellPart(part.id);
                        partDetailModal.style.display = 'none'; // Close modal after selling
                        updateUI(); // Refresh UI
                    };
                } else {
                    modalSellButton.style.display = 'none';
                }

                partDetailModal.style.display = 'block';
            }
        }

        closePartDetailModal.onclick = () => {
            partDetailModal.style.display = 'none';
        };

        window.onclick = (event) => {
            if (event.target === partDetailModal) {
                partDetailModal.style.display = 'none';
            }
        };


        function renderCreatePanel() {
            availablePartsDiv.innerHTML = '<p>–ó–¥–µ—Å—å –≤—ã —Å–º–æ–∂–µ—Ç–µ –æ–±—ä–µ–¥–∏–Ω—è—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤! (–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)</p>';
        }

        function renderShopItems() {
            const buyableParts = ALL_CODE_PARTS.filter(part => {
                // –ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è —É–∂–µ –µ—Å—Ç—å –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏, –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ–µ –≤ –º–∞–≥–∞–∑–∏–Ω–µ –¥–ª—è –ø–æ–∫—É–ø–∫–∏
                return !gameData.collection.some(item => item.id === part.id);
            });

            if (buyableParts.length === 0) {
                buyableItemsList.innerHTML = '<p>–í—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ–±—Ä–∞–Ω—ã! üèÜ</p>';
            } else {
                buyableItemsList.innerHTML = '';
                const sortedBuyableParts = [...buyableParts].sort((a, b) => a.name.localeCompare(b.name));

                sortedBuyableParts.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'list-item';
                    div.innerHTML = `
                        <div class="list-item-main">
                            <span class="list-item-name">${item.emoji} ${item.name}</span>
                            <div class="list-item-description">
                                ${item.description}
                                ${item.example ? `<br><br><strong>–ü—Ä–∏–º–µ—Ä:</strong><pre><code>${item.example}</code></pre>` : ''}
                            </div>
                        </div>
                        <button class="item-action-button buy-button" data-item-id="${item.id}">–ö—É–ø–∏—Ç—å (${PART_PRICE} üåü)</button>
                    `;
                    const buyButton = div.querySelector('.buy-button');
                    buyButton.disabled = gameData.experience < PART_PRICE;
                    buyButton.onclick = (event) => {
                        event.stopPropagation();
                        buyPart(item.id);
                    };
                    div.querySelector('.list-item-main').onclick = () => {
                        const descElement = div.querySelector('.list-item-description');
                        if (descElement) {
                            descElement.classList.toggle('show');
                        }
                    };
                    buyableItemsList.appendChild(div);
                });
            }
        }

        function renderMarketItems() {
            // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –∏–º–µ—é—Ç rarity –∏ –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –∏–≥—Ä–æ–∫–∞
            const rareParts = ALL_CODE_PARTS.filter(part =>
                part.rarity && part.rarity !== 'common' && // –ò—Å–∫–ª—é—á–∞–µ–º common
                !gameData.collection.some(item => item.id === part.id)
            );

            if (rareParts.length === 0) {
                marketItemsList.innerHTML = '<p>–ù–∞ —Ä—ã–Ω–∫–µ –ø–æ–∫–∞ –Ω–µ—Ç —Ä–µ–¥–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π, –∏–ª–∏ –≤—ã —É–∂–µ —Å–æ–±—Ä–∞–ª–∏ –∏—Ö –≤—Å–µ!</p>';
            } else {
                marketItemsList.innerHTML = '';
                const sortedRareParts = [...rareParts].sort((a, b) => a.name.localeCompare(b.name));

                sortedRareParts.forEach(item => {
                    const rarityInfo = RARITIES[item.rarity] || { price: 1, chance: 0 };
                    const marketPrice = rarityInfo.price; // –¶–µ–Ω–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–µ–¥–∫–æ—Å—Ç–∏

                    const div = document.createElement('div');
                    div.className = 'list-item';
                    div.innerHTML = `
                        <div class="list-item-main">
                            <span class="list-item-name">${item.emoji} ${item.name} (–†–µ–¥–∫–æ—Å—Ç—å: ${item.rarity})</span>
                            <div class="list-item-description">
                                ${item.description}
                                ${item.example ? `<br><br><strong>–ü—Ä–∏–º–µ—Ä:</strong><pre><code>${item.example}</code></pre>` : ''}
                            </div>
                        </div>
                        <button class="item-action-button market-buy-button" data-item-id="${item.id}">–ö—É–ø–∏—Ç—å (${marketPrice} üåü)</button>
                    `;
                    const buyButton = div.querySelector('.market-buy-button');
                    buyButton.disabled = gameData.experience < marketPrice;
                    buyButton.onclick = (event) => {
                        event.stopPropagation();
                        buyPartFromMarket(item.id, marketPrice);
                    };
                     div.querySelector('.list-item-main').onclick = () => {
                        const descElement = div.querySelector('.list-item-description');
                        if (descElement) {
                            descElement.classList.toggle('show');
                        }
                    };
                    marketItemsList.appendChild(div);
                });
            }
        }

        function renderAchievements() {
            achievementsList.innerHTML = '';
            const allAchievements = [
                { id: 'collect_5_unique', name: '–ü–µ—Ä–≤–æ–æ—Ç–∫—Ä—ã–≤–∞—Ç–µ–ª—å', description: '–°–æ–±—Ä–∞—Ç—å 5 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö SQL-—Ñ—É–Ω–∫—Ü–∏–π', threshold: 5, type: 'unique_parts' },
                { id: 'collect_10_unique', name: '–Æ–Ω—ã–π –ë–∞–∑–∏—Å—Ç', description: '–°–æ–±—Ä–∞—Ç—å 10 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö SQL-—Ñ—É–Ω–∫—Ü–∏–π', threshold: 10, type: 'unique_parts' },
                { id: 'collect_20_unique', name: '–ú–∞—Å—Ç–µ—Ä –ó–∞–ø—Ä–æ—Å–æ–≤', description: '–°–æ–±—Ä–∞—Ç—å 20 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö SQL-—Ñ—É–Ω–∫—Ü–∏–π', threshold: 20, type: 'unique_parts' },
                { id: 'collect_all_unique', name: '–í–µ–ª–∏–∫–∏–π –°–±–æ—Ä—â–∏–∫', description: `–°–æ–±—Ä–∞—Ç—å –≤—Å–µ ${ALL_CODE_PARTS.length} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö SQL-—Ñ—É–Ω–∫—Ü–∏–π`, threshold: ALL_CODE_PARTS.length, type: 'unique_parts' },
                { id: 'earn_50_xp', name: '–û–ø—ã—Ç–Ω—ã–π –ö–æ–¥–µ—Ä', description: '–ó–∞—Ä–∞–±–æ—Ç–∞—Ç—å 50 –æ–ø—ã—Ç–∞', threshold: 50, type: 'total_xp' },
                { id: 'earn_200_xp', name: '–ì—É—Ä—É SQL', description: '–ó–∞—Ä–∞–±–æ—Ç–∞—Ç—å 200 –æ–ø—ã—Ç–∞', threshold: 200, type: 'total_xp' },
                { id: 'sell_5_parts', name: '–¢–æ—Ä–≥–æ–≤–µ—Ü –î–∞–Ω–Ω—ã–º–∏', description: '–ü—Ä–æ–¥–∞—Ç—å 5 SQL-—Ñ—É–Ω–∫—Ü–∏–π', threshold: 5, type: 'parts_sold' },
                { id: 'buy_5_parts', name: '–û–ø—ã—Ç–Ω—ã–π –ü–æ–∫—É–ø–∞—Ç–µ–ª—å', description: '–ö—É–ø–∏—Ç—å 5 SQL-—Ñ—É–Ω–∫—Ü–∏–π', threshold: 5, type: 'parts_bought' },
                { id: 'complete_1_project', name: '–ü–µ—Ä–≤—ã–π –ü—Ä–æ–µ–∫—Ç', description: '–ó–∞–≤–µ—Ä—à–∏—Ç—å 1 –ø—Ä–æ–µ–∫—Ç', threshold: 1, type: 'projects_completed' }
            ];

            allAchievements.forEach(ach => {
                const isCompleted = gameData.achievements[ach.id] && gameData.achievements[ach.id].completed;
                const div = document.createElement('div');
                div.className = `achievement-item ${isCompleted ? 'completed' : ''}`;
                div.innerHTML = `
                    <div>
                        <strong>${ach.name}</strong><br>
                        <span>${ach.description}</span>
                    </div>
                    ${isCompleted ? '<span>&#10003; –ü–æ–ª—É—á–µ–Ω–æ!</span>' : ''}
                `;
                achievementsList.appendChild(div);
            });
        }

        function renderStats() {
            statsUniqueCount.textContent = gameData.collection.length;
            const totalParts = gameData.collection.reduce((sum, item) => sum + item.count, 0);
            statsTotalCount.textContent = totalParts;
            statsExperienceEarned.textContent = gameData.totalXpEarned;
            statsPartsSold.textContent = gameData.partsSold;
            statsPartsBought.textContent = gameData.partsBought;
        }

        function renderProjects() {
            projectList.innerHTML = '';
            gameData.projects.forEach(project => {
                const div = document.createElement('div');
                div.className = `project-item ${project.completed ? 'completed' : ''}`;

                let requirementsHtml = '<ul>';
                let allRequirementsMet = true;
                project.requirements.forEach(reqId => {
                    const requiredPart = ALL_CODE_PARTS.find(p => p.id === reqId);
                    const hasPart = gameData.collection.some(item => item.id === reqId);
                    const metClass = hasPart ? 'requirement-met' : '';
                    if (!hasPart) allRequirementsMet = false;
                    requirementsHtml += `<li class="${metClass}">${requiredPart ? requiredPart.emoji + ' ' + requiredPart.name : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è'} ${hasPart ? '&#10003;' : '&#10007;'}</li>`;
                });
                requirementsHtml += '</ul>';

                div.innerHTML = `
                    <h4>${project.name}</h4>
                    <p>${project.description}</p>
                    <p><strong>–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:</strong></p>
                    ${requirementsHtml}
                    <p><strong>–ù–∞–≥—Ä–∞–¥–∞:</strong> ${project.reward_xp} üåü</p>
                    ${project.completed ? '<p style="color: var(--primary-color); font-weight: bold;">–ü—Ä–æ–µ–∫—Ç –∑–∞–≤–µ—Ä—à–µ–Ω!</p>' :
                    `<button class="project-action-button secondary-button" data-project-id="${project.id}" ${!allRequirementsMet ? 'disabled' : ''}>–ó–∞–≤–µ—Ä—à–∏—Ç—å –ø—Ä–æ–µ–∫—Ç</button>`}
                `;

                if (!project.completed && allRequirementsMet) {
                    div.querySelector('.project-action-button').onclick = () => completeProject(project.id);
                }
                projectList.appendChild(div);
            });

            if (gameData.projects.filter(p => !p.completed).length === 0) {
                 projectList.innerHTML += '<p>–í—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã! –ñ–¥–∏—Ç–µ –Ω–æ–≤—ã—Ö!</p>';
            }
        }

        function renderBoosters() {
            boosterList.innerHTML = '';
            BOOSTERS.forEach(booster => {
                const div = document.createElement('div');
                div.className = 'booster-item';
                const isActive = gameData.activeBoosters.some(b => b.id === booster.id && b.endsAt > Date.now());

                div.innerHTML = `
                    <div>
                        <strong>${booster.name}</strong><br>
                        <span>${booster.description}</span><br>
                        ${booster.effect.type === 'xp_multiplier' && isActive ? `<span style="color:var(--primary-color);">–ê–∫—Ç–∏–≤–µ–Ω! –û—Å—Ç–∞–ª–æ—Å—å: ${formatTime(gameData.activeBoosters.find(b => b.id === booster.id).endsAt - Date.now())}</span>` : ''}
                        ${booster.effect.type === 'rare_chance' && isActive ? `<span style="color:var(--primary-color);">–ê–∫—Ç–∏–≤–µ–Ω! –û—Å—Ç–∞–ª–æ—Å—å: ${formatTime(gameData.activeBoosters.find(b => b.id === booster.id).endsAt - Date.now())}</span>` : ''}
                    </div>
                    <button data-booster-id="${booster.id}" ${gameData.experience < booster.cost || isActive ? 'disabled' : ''}>–ö—É–ø–∏—Ç—å (${booster.cost} üåü)</button>
                `;
                div.querySelector('button').onclick = () => buyBooster(booster.id);
                boosterList.appendChild(div);
            });
        }

        function renderHistory() {
            if (gameData.history.length === 0) {
                historyLog.innerHTML = '<p>–í–∞—à–∞ –∏—Å—Ç–æ—Ä–∏—è –¥–µ–π—Å—Ç–≤–∏–π –ø—É—Å—Ç–∞.</p>';
            } else {
                historyLog.innerHTML = '';
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10-15 –∑–∞–ø–∏—Å–µ–π
                const recentHistory = gameData.history.slice(-15).reverse();
                recentHistory.forEach(entry => {
                    const date = new Date(entry.timestamp);
                    const timeString = date.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
                    const div = document.createElement('div');
                    div.className = 'history-entry';
                    div.textContent = `[${timeString}] ${entry.message}`;
                    historyLog.appendChild(div);
                });
            }
        }


        // --- –õ–æ–≥–∏–∫–∞ –∏–≥—Ä—ã ---
        function addExperience(amount) {
            let actualAmount = amount;
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –±—É—Å—Ç–µ—Ä—ã –æ–ø—ã—Ç–∞
            const xpBooster = gameData.activeBoosters.find(b => b.id === 'xp_boost' && b.endsAt > Date.now());
            if (xpBooster) {
                actualAmount *= xpBooster.effect.value;
                gameData.message += ` (–ë—É—Å—Ç–µ—Ä XP: x${xpBooster.effect.value})`;
            }

            gameData.experience += actualAmount;
            gameData.currentXp += actualAmount;
            gameData.totalXpEarned += actualAmount;

            checkLevelUp();
            checkAchievements();
            addHistoryEntry(`–ü–æ–ª—É—á–µ–Ω–æ ${actualAmount} –æ–ø—ã—Ç–∞.`);
        }

        function checkLevelUp() {
            while (gameData.currentXp >= gameData.xpToNextLevel) {
                gameData.currentXp -= gameData.xpToNextLevel;
                gameData.level++;
                gameData.xpToNextLevel = Math.floor(XP_PER_LEVEL_BASE * Math.pow(XP_PER_LEVEL_MULTIPLIER, gameData.level - 1));
                // –ü—Ä–∏ –∫–∞–∂–¥–æ–º –Ω–æ–≤–æ–º —É—Ä–æ–≤–Ω–µ –º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —ç–Ω–µ—Ä–≥–∏—é
                gameData.maxEnergy++;
                gameData.energy = gameData.maxEnergy; // –ü–æ–ª–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏ –ø—Ä–∏ —É—Ä–æ–≤–Ω–µ
                gameData.message = `–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ –£—Ä–æ–≤–Ω—è ${gameData.level}! üéâ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è —É–≤–µ–ª–∏—á–µ–Ω–∞ –¥–æ ${gameData.maxEnergy}!`;
                addHistoryEntry(`–£—Ä–æ–≤–µ–Ω—å –ø–æ–≤—ã—à–µ–Ω –¥–æ ${gameData.level}!`);
            }
        }

        function checkAchievements() {
            const uniquePartsCount = gameData.collection.length;
            const completedProjectsCount = gameData.projects.filter(p => p.completed).length;

            const allAchievements = [
                { id: 'collect_5_unique', threshold: 5, type: 'unique_parts' },
                { id: 'collect_10_unique', threshold: 10, type: 'unique_parts' },
                { id: 'collect_20_unique', threshold: 20, type: 'unique_parts' },
                { id: 'collect_all_unique', threshold: ALL_CODE_PARTS.length, type: 'unique_parts' },
                { id: 'earn_50_xp', threshold: 50, type: 'total_xp' },
                { id: 'earn_200_xp', threshold: 200, type: 'total_xp' },
                { id: 'sell_5_parts', threshold: 5, type: 'parts_sold' },
                { id: 'buy_5_parts', threshold: 5, type: 'parts_bought' },
                { id: 'complete_1_project', threshold: 1, type: 'projects_completed' }
            ];

            allAchievements.forEach(ach => {
                if (!gameData.achievements[ach.id].completed) {
                    let meetsCondition = false;
                    if (ach.type === 'unique_parts' && uniquePartsCount >= ach.threshold) meetsCondition = true;
                    if (ach.type === 'total_xp' && gameData.totalXpEarned >= ach.threshold) meetsCondition = true;
                    if (ach.type === 'parts_sold' && gameData.partsSold >= ach.threshold) meetsCondition = true;
                    if (ach.type === 'parts_bought' && gameData.partsBought >= ach.threshold) meetsCondition = true;
                    if (ach.type === 'projects_completed' && completedProjectsCount >= ach.threshold) meetsCondition = true;

                    if (meetsCondition) {
                        gameData.achievements[ach.id].completed = true;
                        addExperience(gameData.achievements[ach.id].reward); // –ù–∞–≥—Ä–∞–¥–∞ –∑–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ
                        gameData.message = `–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ "${ach.name}" –ø–æ–ª—É—á–µ–Ω–æ! (+${gameData.achievements[ach.id].reward} üåü)`;
                    }
                }
            });
        }


        // –õ–æ–≥–∏–∫–∞ –ø–æ–∫—É–ø–∫–∏ –≤ –æ–±—ã—á–Ω–æ–º –º–∞–≥–∞–∑–∏–Ω–µ
        function buyPart(partId) {
            if (gameData.experience < PART_PRICE) {
                gameData.message = '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–ø—ã—Ç–∞ –¥–ª—è –ø–æ–∫—É–ø–∫–∏! üö´';
                updateUI();
                return;
            }

            const partToBuy = ALL_CODE_PARTS.find(part => part.id === partId);
            if (!partToBuy) {
                gameData.message = '–û—à–∏–±–∫–∞: —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.';
                updateUI();
                return;
            }

            const existingPart = gameData.collection.find(item => item.id === partId);

            if (!existingPart) {
                gameData.collection.push({...partToBuy, count: 1});
            } else {
                existingPart.count++;
            }

            gameData.experience -= PART_PRICE;
            gameData.partsBought++;
            gameData.message = `–í—ã –∫—É–ø–∏–ª–∏ ${partToBuy.emoji} ${partToBuy.name}! (-${PART_PRICE} üåü)`;
            addHistoryEntry(`–ö—É–ø–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è: ${partToBuy.name}`);
            checkAchievements(); // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ø–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏
            updateUI();
        }

        // –õ–æ–≥–∏–∫–∞ –ø–æ–∫—É–ø–∫–∏ –Ω–∞ —Ä—ã–Ω–∫–µ —Ä–µ–¥–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π
        function buyPartFromMarket(partId, price) {
            if (gameData.experience < price) {
                gameData.message = '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–ø—ã—Ç–∞ –¥–ª—è –ø–æ–∫—É–ø–∫–∏! üö´';
                updateUI();
                return;
            }

            const partToBuy = ALL_CODE_PARTS.find(part => part.id === partId);
            if (!partToBuy) {
                gameData.message = '–û—à–∏–±–∫–∞: —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.';
                updateUI();
                return;
            }

            // –ù–∞ —Ä—ã–Ω–∫–µ –ø–æ–∫—É–ø–∞–µ–º —Ç–æ–ª—å–∫–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã—Ö —É –Ω–∞—Å –Ω–µ—Ç
            const existingPart = gameData.collection.find(item => item.id === partId);
            if (existingPart) {
                 gameData.message = `–û—à–∏–±–∫–∞: ${partToBuy.name} —É–∂–µ –µ—Å—Ç—å –≤ –≤–∞—à–µ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏!`;
                 updateUI();
                 return;
            }

            gameData.collection.push({...partToBuy, count: 1});
            gameData.experience -= price;
            gameData.partsBought++;
            gameData.message = `–í—ã –∫—É–ø–∏–ª–∏ —Ä–µ–¥–∫—É—é —Ñ—É–Ω–∫—Ü–∏—é ${partToBuy.emoji} ${partToBuy.name} –Ω–∞ —Ä—ã–Ω–∫–µ! (-${price} üåü)`;
            addHistoryEntry(`–ö—É–ø–ª–µ–Ω–∞ —Ä–µ–¥–∫–∞—è —Ñ—É–Ω–∫—Ü–∏—è: ${partToBuy.name} –∑–∞ ${price} üåü`);
            checkAchievements(); // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
            updateUI();
        }

        // –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–¥–∞–∂–∏
        function sellPart(partId) {
            const existingPart = gameData.collection.find(item => item.id === partId);

            if (existingPart) {
                if (existingPart.count > 1) {
                    existingPart.count--;
                    gameData.message = `–í—ã –ø—Ä–æ–¥–∞–ª–∏ ${existingPart.emoji} ${existingPart.name}! –¢–µ–ø–µ—Ä—å —É –≤–∞—Å –∏—Ö ${existingPart.count}. (+${PART_PRICE} üåü)`;
                } else {
                    gameData.collection = gameData.collection.filter(item => item.id !== partId);
                    gameData.message = `–í—ã –ø—Ä–æ–¥–∞–ª–∏ –ø–æ—Å–ª–µ–¥–Ω—é—é ${existingPart.emoji} ${existingPart.name}! (+${PART_PRICE} üåü)`;
                }
                gameData.experience += PART_PRICE;
                gameData.partsSold++;
                addHistoryEntry(`–ü—Ä–æ–¥–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è: ${existingPart.name}`);
                checkAchievements(); // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
            } else {
                gameData.message = '–û—à–∏–±–∫–∞: —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–µ—Ç –≤ –≤–∞—à–µ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏.';
            }
            updateUI();
        }

        // --- –≠–Ω–µ—Ä–≥–∏—è ---
        function updateEnergy() {
            const now = Date.now();
            const timeElapsed = now - gameData.lastEnergyRecovery;
            const energyToRecover = Math.floor(timeElapsed / ENERGY_RECOVERY_INTERVAL_MS) * gameData.energyRecoveryRate;

            if (energyToRecover > 0) {
                gameData.energy = Math.min(gameData.maxEnergy, gameData.energy + energyToRecover);
                gameData.lastEnergyRecovery = now; // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏
            }
        }

        // --- –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å ---
        function checkDailyBonusAvailability() {
            const now = Date.now();
            if (now - gameData.lastDailyBonusClaim >= DAILY_BONUS_COOLDOWN_MS) {
                dailyBonusMessage.textContent = `–í–∞—à –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å –≥–æ—Ç–æ–≤! –ü–æ–ª—É—á–∏—Ç–µ ${DAILY_BONUS_AMOUNT} –æ–ø—ã—Ç–∞.`;
                claimDailyBonusButton.disabled = false;
            } else {
                const timeLeftMs = DAILY_BONUS_COOLDOWN_MS - (now - gameData.lastDailyBonusClaim);
                dailyBonusMessage.textContent = `–°–ª–µ–¥—É—é—â–∏–π –±–æ–Ω—É—Å —á–µ—Ä–µ–∑: ${formatTime(timeLeftMs)}`;
                claimDailyBonusButton.disabled = true;
            }
        }

        function claimDailyBonus() {
            const now = Date.now();
            if (now - gameData.lastDailyBonusClaim >= DAILY_BONUS_COOLDOWN_MS) {
                addExperience(DAILY_BONUS_AMOUNT);
                gameData.lastDailyBonusClaim = now;
                gameData.message = `–í—ã –ø–æ–ª—É—á–∏–ª–∏ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å! (+${DAILY_BONUS_AMOUNT} üåü)`;
                addHistoryEntry(`–ü–æ–ª—É—á–µ–Ω –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å: +${DAILY_BONUS_AMOUNT} üåü`);
                updateUI();
            } else {
                gameData.message = '–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å –ø–æ–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.';
                updateUI();
            }
        }

        // --- –ü—Ä–æ–µ–∫—Ç—ã ---
        function completeProject(projectId) {
            const project = gameData.projects.find(p => p.id === projectId);
            if (!project || project.completed) {
                gameData.message = '–û—à–∏–±–∫–∞: –ø—Ä–æ–µ–∫—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ —É–∂–µ –∑–∞–≤–µ—Ä—à–µ–Ω.';
                updateUI();
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
            const allRequirementsMet = project.requirements.every(reqId =>
                gameData.collection.some(item => item.id === reqId && item.count > 0)
            );

            if (allRequirementsMet) {
                project.completed = true;
                addExperience(project.reward_xp);
                gameData.message = `–ü—Ä–æ–µ–∫—Ç "${project.name}" –∑–∞–≤–µ—Ä—à–µ–Ω! –ù–∞–≥—Ä–∞–¥–∞: ${project.reward_xp} üåü!`;
                addHistoryEntry(`–ó–∞–≤–µ—Ä—à–µ–Ω –ø—Ä–æ–µ–∫—Ç: "${project.name}"`);
                checkAchievements(); // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞
                updateUI();
            } else {
                gameData.message = '–£ –≤–∞—Å –Ω–µ—Ç –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —ç—Ç–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞.';
                updateUI();
            }
        }

        // --- –ë—É—Å—Ç–µ—Ä—ã ---
        function buyBooster(boosterId) {
            const booster = BOOSTERS.find(b => b.id === boosterId);
            if (!booster) return;

            if (gameData.experience < booster.cost) {
                gameData.message = '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–ø—ã—Ç–∞ –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –±—É—Å—Ç–µ—Ä–∞! üö´';
                updateUI();
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω –ª–∏ —É–∂–µ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π –±—É—Å—Ç–µ—Ä –∏–ª–∏ –±—É—Å—Ç–µ—Ä —Å –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é
            if (booster.duration && gameData.activeBoosters.some(b => b.id === boosterId && b.endsAt > Date.now())) {
                 gameData.message = `${booster.name} —É–∂–µ –∞–∫—Ç–∏–≤–µ–Ω!`;
                 updateUI();
                 return;
            }
            if (!booster.duration && booster.effect.type === 'energy_refill' && gameData.energy === gameData.maxEnergy) {
                 gameData.message = '–≠–Ω–µ—Ä–≥–∏—è —É–∂–µ –ø–æ–ª–Ω–∞—è, –±—É—Å—Ç–µ—Ä –Ω–µ –Ω—É–∂–µ–Ω!';
                 updateUI();
                 return;
            }


            gameData.experience -= booster.cost;
            gameData.message = `–í—ã –∫—É–ø–∏–ª–∏ "${booster.name}"! (-${booster.cost} üåü)`;
            addHistoryEntry(`–ö—É–ø–ª–µ–Ω –±—É—Å—Ç–µ—Ä: "${booster.name}" –∑–∞ ${booster.cost} üåü`);


            if (booster.effect.type === 'xp_multiplier' || booster.effect.type === 'rare_chance') {
                gameData.activeBoosters.push({
                    id: booster.id,
                    endsAt: Date.now() + booster.duration,
                    effect: booster.effect // Store effect for easy lookup
                });
                gameData.message += ` –ê–∫—Ç–∏–≤–µ–Ω ${formatTime(booster.duration)}!`;
            } else if (booster.effect.type === 'energy_refill') {
                gameData.energy = Math.min(gameData.maxEnergy, gameData.energy + booster.effect.value);
                gameData.message += ` –≠–Ω–µ—Ä–≥–∏—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∞ –Ω–∞ ${booster.effect.value} ‚ö°Ô∏è!`;
            }
            updateUI();
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –∏—Å—Ç–µ–∫—à–∏—Ö –±—É—Å—Ç–µ—Ä–æ–≤
        function cleanExpiredBoosters() {
            gameData.activeBoosters = gameData.activeBoosters.filter(b => b.endsAt > Date.now());
        }

        // --- –ò—Å—Ç–æ—Ä–∏—è –¥–µ–π—Å—Ç–≤–∏–π ---
        function addHistoryEntry(text) {
            gameData.history.push({ timestamp: Date.now(), message: text });
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é, —á—Ç–æ–±—ã –Ω–µ —Ä–∞–∑—Ä–∞—Å—Ç–∞–ª–∞—Å—å –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ
            if (gameData.history.length > 50) {
                gameData.history = gameData.history.slice(gameData.history.length - 50);
            }
        }


        // --- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ ---
        function formatTime(ms) {
            const totalSeconds = Math.floor(ms / 1000);
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;

            if (hours > 0) return `${hours}—á ${minutes}–º`;
            if (minutes > 0) return `${minutes}–º ${seconds}—Å`;
            return `${seconds}—Å`;
        }

        // --- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –∫–Ω–æ–ø–æ–∫ ---
        collectButton.addEventListener('click', () => {
            if (gameData.energy < ENERGY_CONSUMPTION_PER_FIND) {
                gameData.message = '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞! üò¥';
                updateUI();
                return;
            }

            gameData.energy -= ENERGY_CONSUMPTION_PER_FIND;
            addHistoryEntry(`–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ ${ENERGY_CONSUMPTION_PER_FIND} —ç–Ω–µ—Ä–≥–∏–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞.`);

            const availableParts = ALL_CODE_PARTS;
            let foundPart = null;

            // –õ–æ–≥–∏–∫–∞ –¥–ª—è —É—á–µ—Ç–∞ –±—É—Å—Ç–µ—Ä–∞ —à–∞–Ω—Å–∞ —Ä–µ–¥–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π
            const rareChanceBooster = gameData.activeBoosters.find(b => b.id === 'find_chance_boost' && b.endsAt > Date.now());
            let currentRareChanceModifier = rareChanceBooster ? rareChanceBooster.effect.value : 0; // –ù–∞–ø—Ä–∏–º–µ—Ä, 0.1

            // –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º —à–∞–Ω—Å—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–¥–∫–æ—Å—Ç–∏
            const weightedParts = [];
            ALL_CODE_PARTS.forEach(part => {
                const rarityDef = RARITIES[part.rarity] || RARITIES.common; // Default to common if not specified
                let baseChance = rarityDef.chance;

                // –ü—Ä–∏–º–µ–Ω—è–µ–º –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±—É—Å—Ç–µ—Ä–∞ –∫ —à–∞–Ω—Å—É —Ä–µ–¥–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π
                if (part.rarity && part.rarity !== 'common') {
                    baseChance = Math.min(1.0, baseChance + currentRareChanceModifier); // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —à–∞–Ω—Å, –Ω–æ –Ω–µ –±–æ–ª–µ–µ 100%
                }

                // –î–æ–±–∞–≤–ª—è–µ–º —á–∞—Å—Ç—å –≤ –º–∞—Å—Å–∏–≤ –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –µ—ë —à–∞–Ω—Å—É
                for (let i = 0; i < Math.round(baseChance * 100); i++) { // –£–º–Ω–æ–∂–∞–µ–º –Ω–∞ 100 –¥–ª—è –¥–∏—Å–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
                    weightedParts.push(part);
                }
            });

            // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—É—é —á–∞—Å—Ç—å –∏–∑ –≤–∑–≤–µ—à–µ–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞
            const randomIndex = Math.floor(Math.random() * weightedParts.length);
            foundPart = weightedParts[randomIndex];

            if (!foundPart) { // –í —Å–ª—É—á–∞–µ –∫–∞–∫–æ–π-—Ç–æ –æ—à–∏–±–∫–∏, –¥–∞–µ–º —Ö–æ—Ç—è –±—ã common
                foundPart = ALL_CODE_PARTS.find(p => p.id === 'sql_select');
            }

            const existingPart = gameData.collection.find(item => item.id === foundPart.id);

            if (!existingPart) {
                gameData.collection.push({...foundPart, count: 1});
                addExperience(1); // 1 XP –∑–∞ –Ω–æ–≤—É—é –Ω–∞—Ö–æ–¥–∫—É
                gameData.message = `–í—ã –Ω–∞—à–ª–∏ –Ω–æ–≤—É—é SQL-—Ñ—É–Ω–∫—Ü–∏—é! üéâ ${foundPart.emoji} ${foundPart.name} (+1 üåü)`;
                addHistoryEntry(`–ù–∞–π–¥–µ–Ω–∞ –Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è: ${foundPart.name}`);
            } else {
                existingPart.count++;
                addExperience(1); // 1 XP –∑–∞ –¥—É–±–ª–∏–∫–∞—Ç
                gameData.message = `–í—ã –Ω–∞—à–ª–∏ ${foundPart.emoji} ${foundPart.name} (—É–∂–µ –µ—Å—Ç—å)! –¢–µ–ø–µ—Ä—å —É –≤–∞—Å –∏—Ö ${existingPart.count}. (+1 üåü)`;
                addHistoryEntry(`–ù–∞–π–¥–µ–Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç —Ñ—É–Ω–∫—Ü–∏–∏: ${foundPart.name} (x${existingPart.count})`);
            }
            updateUI();
        });


        viewCollectionButton.addEventListener('click', () => {
            gameData.currentView = 'collection';
            gameData.message = '–í–∞—à–∞ –∫–æ–ª–ª–µ–∫—Ü–∏—è SQL-—Ñ—É–Ω–∫—Ü–∏–π:';
            updateUI();
        });

        createButton.addEventListener('click', () => {
            gameData.currentView = 'create';
            gameData.message = '–ß—Ç–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–æ–∑–¥–∞—Ç—å?';
            updateUI();
        });

        shopButton.addEventListener('click', () => {
            gameData.currentView = 'shop';
            gameData.message = '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–∞–≥–∞–∑–∏–Ω!';
            updateUI();
        });

        marketButton.addEventListener('click', () => { // New Market Button
            gameData.currentView = 'market';
            gameData.message = '–ò—Å—Å–ª–µ–¥—É–π—Ç–µ —Ä–µ–¥–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ —Ä—ã–Ω–∫–µ!';
            updateUI();
        });

        dailyBonusButton.addEventListener('click', () => {
            gameData.currentView = 'daily_bonus';
            updateUI();
        });
        claimDailyBonusButton.addEventListener('click', claimDailyBonus);

        achievementsButton.addEventListener('click', () => {
            gameData.currentView = 'achievements';
            gameData.message = '–í–∞—à–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:';
            updateUI();
        });

        statsButton.addEventListener('click', () => {
            gameData.currentView = 'stats';
            gameData.message = '–í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:';
            updateUI();
        });

        projectBoardButton.addEventListener('click', () => { // New Project Board Button
            gameData.currentView = 'projects';
            gameData.message = '–í—ã–ø–æ–ª–Ω—è–π—Ç–µ –ø—Ä–æ–µ–∫—Ç—ã –∏ –ø–æ–ª—É—á–∞–π—Ç–µ –Ω–∞–≥—Ä–∞–¥—ã!';
            updateUI();
        });

        boostersButton.addEventListener('click', () => { // New Boosters Button
            gameData.currentView = 'boosters';
            gameData.message = '–£—Å–∏–ª—å—Ç–µ —Å–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å!';
            updateUI();
        });

        historyButton.addEventListener('click', () => { // New History Button
            gameData.currentView = 'history';
            gameData.message = '–ñ—É—Ä–Ω–∞–ª –≤–∞—à–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π:';
            updateUI();
        });

        // –ö–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥" (–æ–±—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞)
        function goBackToMain() {
            gameData.currentView = 'main';
            gameData.message = '–ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è!';
            updateUI();
        }
        backFromCollectionButton.addEventListener('click', goBackToMain);
        backFromCreateButton.addEventListener('click', goBackToMain);
        backFromShopButton.addEventListener('click', goBackToMain);
        backFromMarketButton.addEventListener('click', goBackToMain); // New
        backFromDailyBonusButton.addEventListener('click', goBackToMain);
        backFromAchievementsButton.addEventListener('click', goBackToMain);
        backFromStatsButton.addEventListener('click', goBackToMain);
        backFromProjectBoardButton.addEventListener('click', goBackToMain); // New
        backFromBoostersButton.addEventListener('click', goBackToMain); // New
        backFromHistoryButton.addEventListener('click', goBackToMain); // New


        // –ö–Ω–æ–ø–∫–∞ —Å–±—Ä–æ—Å–∞ –∏–≥—Ä—ã
        resetGameButton.addEventListener('click', () => {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É –∑–∞–Ω–æ–≤–æ? –í—Å–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã!')) {
                localStorage.removeItem('coderGameData');
                // –°–±—Ä–æ—Å gameData –¥–æ –Ω–∞—á–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (–≤–∞–∂–Ω–æ, —á—Ç–æ–±—ã —Å–æ–≤–ø–∞–¥–∞–ª–∏ —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º–∏)
                gameData = {
                    message: "–ò–≥—Ä–∞ –Ω–∞—á–∞—Ç–∞ –∑–∞–Ω–æ–≤–æ! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!",
                    collection: [],
                    experience: 0,
                    level: 1,
                    xpToNextLevel: 100,
                    currentXp: 0,
                    totalXpEarned: 0,
                    partsSold: 0,
                    partsBought: 0,
                    lastDailyBonusClaim: 0,
                    energy: 10,
                    maxEnergy: 10,
                    energyRecoveryRate: 1,
                    lastEnergyRecovery: Date.now(),
                    activeBoosters: [],
                    history: [],
                    achievements: {
                        collect_5_unique: { completed: false, reward: 10 },
                        collect_10_unique: { completed: false, reward: 20 },
                        collect_20_unique: { completed: false, reward: 40 },
                        collect_all_unique: { completed: false, reward: 100 },
                        earn_50_xp: { completed: false, reward: 15 },
                        earn_200_xp: { completed: false, reward: 50 },
                        sell_5_parts: { completed: false, reward: 10 },
                        buy_5_parts: { completed: false, reward: 10 },
                        complete_1_project: { completed: false, reward: 25 },
                    },
                    projects: [ // Reset projects to their initial incomplete state
                        { id: 'proj_basic_select', name: '–ë–∞–∑–æ–≤–∞—è –≤—ã–±–æ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö', description: '–ò–∑–≤–ª–µ—á—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã Customers.', requirements: ['sql_select', 'sql_from'], completed: false, reward_xp: 20 },
                        { id: 'proj_filtered_select', name: '–í—ã–±–æ—Ä–∫–∞ —Å —Ñ–∏–ª—å—Ç—Ä–æ–º', description: '–ù–∞–π—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç—ã –¥–æ—Ä–æ–∂–µ 50.', requirements: ['sql_select', 'sql_from', 'sql_where'], completed: false, reward_xp: 35 },
                        { id: 'proj_insert_data', name: '–í—Å—Ç–∞–≤–∫–∞ –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏', description: '–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Ç–∞–±–ª–∏—Ü—É.', requirements: ['sql_insert_into', 'sql_values'], completed: false, reward_xp: 25 },
                        { id: 'proj_update_record', name: '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏', description: '–ò–∑–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∑–∞–ø–∏—Å–∏.', requirements: ['sql_update', 'sql_set', 'sql_where'], completed: false, reward_xp: 30 },
                        { id: 'proj_delete_record', name: '–£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏', description: '–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å –∏–∑ —Ç–∞–±–ª–∏—Ü—ã.', requirements: ['sql_delete_from', 'sql_where'], completed: false, reward_xp: 20 },
                        { id: 'proj_table_join', name: '–û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü', description: '–°–æ–µ–¥–∏–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ Customers –∏ Orders.', requirements: ['sql_select', 'sql_from', 'sql_join', 'sql_on'], completed: false, reward_xp: 50 },
                        { id: 'proj_create_simple_table', name: '–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–π —Ç–∞–±–ª–∏—Ü—ã', description: '–°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É —Å ID –∏ –∏–º–µ–Ω–µ–º.', requirements: ['sql_create_table', 'sql_int', 'sql_varchar'], completed: false, reward_xp: 40 },
                        { id: 'proj_count_records', name: '–ü–æ–¥—Å—á–µ—Ç –∑–∞–ø–∏—Å–µ–π', description: '–ü–æ—Å—á–∏—Ç–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –≤ —Ç–∞–±–ª–∏—Ü–µ.', requirements: ['sql_select', 'sql_count', 'sql_from'], completed: false, reward_xp: 20 },
                        { id: 'proj_aggregate_data', name: '–ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö', description: '–í—ã—á–∏—Å–ª–∏—Ç—å —Å—Ä–µ–¥–Ω—é—é —Ü–µ–Ω—É –ø—Ä–æ–¥—É–∫—Ç–æ–≤, —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.', requirements: ['sql_select', 'sql_avg', 'sql_group_by'], completed: false, reward_xp: 45 }
                    ],
                    currentView: 'main'
                };
                updateUI();
                setTimeout(() => {
                    if (window.Telegram && window.Telegram.WebApp) {
                        // Telegram.WebApp.close(); // –ú–æ–∂–Ω–æ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∑–∞–∫—Ä—ã—Ç—å Mini App, –Ω–æ —á–∞—Å—Ç–æ –ª—É—á—à–µ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å
                        location.reload();
                    } else {
                        location.reload();
                    }
                }, 100);
            }
        });


        // --- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã ---
        function saveGameData() {
            localStorage.setItem('coderGameData', JSON.stringify(gameData));
            // console.log('Game data saved!');
        }

        function loadGameData() {
            const savedData = localStorage.getItem('coderGameData');
            if (savedData) {
                const loadedGameData = JSON.parse(savedData);

                // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –∏—Å–ø–æ–ª—å–∑—É—è –æ–ø–µ—Ä–∞—Ç–æ—Ä ?? –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é,
                // –µ—Å–ª–∏ –≤ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç (–¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π)
                gameData.experience = loadedGameData.experience ?? 0;
                gameData.level = loadedGameData.level ?? 1;
                gameData.xpToNextLevel = loadedGameData.xpToNextLevel ?? 100;
                gameData.currentXp = loadedGameData.currentXp ?? 0;
                gameData.totalXpEarned = loadedGameData.totalXpEarned ?? 0;
                gameData.partsSold = loadedGameData.partsSold ?? 0;
                gameData.partsBought = loadedGameData.partsBought ?? 0;
                gameData.lastDailyBonusClaim = loadedGameData.lastDailyBonusClaim ?? 0;
                gameData.energy = loadedGameData.energy ?? 10;
                gameData.maxEnergy = loadedGameData.maxEnergy ?? 10;
                gameData.energyRecoveryRate = loadedGameData.energyRecoveryRate ?? 1;
                gameData.lastEnergyRecovery = loadedGameData.lastEnergyRecovery ?? Date.now();
                gameData.currentView = loadedGameData.currentView ?? 'main';

                // –ó–∞–≥—Ä—É–∑–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –±—É—Å—Ç–µ—Ä–æ–≤ –∏ –æ—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–µ–∫—à–∏—Ö
                gameData.activeBoosters = (loadedGameData.activeBoosters || []).filter(b => b.endsAt > Date.now());

                // –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏
                gameData.history = loadedGameData.history || [];

                // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
                for (const achId in gameData.achievements) {
                    if (loadedGameData.achievements && loadedGameData.achievements[achId]) {
                        gameData.achievements[achId].completed = loadedGameData.achievements[achId].completed;
                    }
                }

                // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤: –≤–∞–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ completed, –Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ ALL_CODE_PARTS
                gameData.projects = (loadedGameData.projects || []).map(savedProj => {
                    const defaultProj = gameData.projects.find(p => p.id === savedProj.id);
                    if (defaultProj) {
                        return { ...defaultProj, completed: savedProj.completed };
                    }
                    return null;
                }).filter(Boolean);
                // –ï—Å–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –ø—Ä–æ–µ–∫—Ç—ã, –∏—Ö –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ gameData.projects
                const newProjects = gameData.projects.filter(p => !loadedGameData.projects.some(sp => sp.id === p.id));
                gameData.projects.push(...newProjects);


                // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–∏: —É–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ —á–∞—Å—Ç–∏ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –≤ ALL_CODE_PARTS
                // –∏ —á—Ç–æ —É –Ω–∏—Ö –µ—Å—Ç—å —Å–≤–æ–π—Å—Ç–≤–æ count
                gameData.collection = (loadedGameData.collection || []).map(item => {
                    const fullItem = ALL_CODE_PARTS.find(part => part.id === item.id);
                    return fullItem ? { ...fullItem, count: item.count || 1 } : null;
                }).filter(Boolean); // –§–∏–ª—å—Ç—Ä—É–µ–º null-–∑–Ω–∞—á–µ–Ω–∏—è, –µ—Å–ª–∏ —Å—Ç–∞—Ä—ã–µ ID –Ω–µ –Ω–∞—à–ª–∏—Å—å
            }
        }


        // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ ---
        loadGameData();
        // –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º —ç–Ω–µ—Ä–≥–∏—é –∏ –æ—á–∏—â–∞–µ–º –±—É—Å—Ç–µ—Ä—ã, –∑–∞—Ç–µ–º –æ–±–Ω–æ–≤–ª—è–µ–º UI
        updateEnergy();
        cleanExpiredBoosters();
        updateUI();

        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω–æ –Ω–µ –±—ã–ª–æ –∏–∑–º–µ–Ω–µ–Ω–æ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        if (gameData.currentView === 'main') {
            gameMessageElement.textContent = `–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –æ–±—Ä–∞—Ç–Ω–æ! –£ –≤–∞—Å ${gameData.experience} üåü`;
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
        setInterval(saveGameData, 5000);

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
        setInterval(updateEnergy, ENERGY_RECOVERY_INTERVAL_MS);
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —ç–Ω–µ—Ä–≥–∏–∏ –∏ –±—É—Å—Ç–µ—Ä–æ–≤
        setInterval(updateUI, 1000); // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É –¥–ª—è —Ç–∞–π–º–µ—Ä–æ–≤
    </script>
</body>
</html>
