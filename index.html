<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Pixel Perfect v9: Smartphone Tycoon</title>
    <style>
        :root {
            --bg-color: #121212; --surface-color: #1e1e1e; --primary-color: #bb86fc; --secondary-color: #03dac6;
            --text-color: #e0e0e0; --text-secondary-color: #a0a0a0; --border-color: #333;
            --success-color: #4caf50; --error-color: #f44336; --warning-color: #ffc107; --xp-color: #2196f3;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html, body { height: 100%; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background-color: var(--bg-color); color: var(--text-color); overflow: hidden; }
        #game-container { display: flex; flex-direction: column; height: 100%; max-width: 500px; margin: 0 auto; background-color: var(--surface-color); box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        #status-bar { padding: 10px 15px; background-color: #2a2a2a; border-bottom: 1px solid var(--border-color); display: grid; grid-template-columns: 1fr 1fr; gap: 10px; align-items: center; flex-shrink: 0; }
        #money { color: var(--success-color); font-weight: bold; font-size: 16px; }
        #date { color: var(--text-secondary-color); text-align: right; }
        #player-level-info { grid-column: 1 / -1; font-size: 12px; }
        #player-level-text { margin-bottom: 4px; }
        #xp-bar-container { width: 100%; height: 6px; background-color: #444; border-radius: 3px; overflow: hidden; }
        #xp-bar { height: 100%; background-color: var(--xp-color); width: 0%; transition: width 0.5s ease-in-out; }
        #main-content { flex-grow: 1; overflow-y: auto; padding: 15px; }
        .screen { display: none; } .screen.active { display: block; }
        h2 { color: var(--primary-color); margin-bottom: 15px; border-bottom: 1px solid var(--border-color); padding-bottom: 10px; }
        h3.section-title { color: var(--secondary-color); margin-top: 20px; margin-bottom: 10px; font-size: 1.1em; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; color: var(--text-secondary-color); font-size: 14px; }
        select, input[type="text"], input[type="number"] { width: 100%; background-color: var(--bg-color); color: var(--text-color); border: 1px solid var(--border-color); padding: 10px; border-radius: 5px; font-size: 16px; }
        select:focus, input:focus { outline: none; border-color: var(--primary-color); }
        button { width: 100%; padding: 12px; background-color: var(--primary-color); color: #000; border: none; border-radius: 5px; font-size: 16px; font-weight: bold; cursor: pointer; transition: background-color 0.2s; margin-top: 5px; }
        button:hover { background-color: #a050f0; }
        button.secondary { background-color: var(--secondary-color); color: #000; } /* Установим цвет текста для secondary */
        button.secondary:hover { background-color: #02b09c; }
        button.error { background-color: var(--error-color); color: var(--text-color); } /* Используем error для сброса */
        button.error:hover { background-color: #d32f2f; }
        button:disabled { background-color: #555; color: #888; cursor: not-allowed; }
        #accessory-selectors { margin-top: 20px; }
        .accessory-item { display: flex; align-items: center; margin-bottom: 10px; }
        .accessory-item input[type="checkbox"] { width: auto; margin-right: 10px; }
        #bottom-nav { display: flex; justify-content: space-around; background-color: #2a2a2a; border-top: 1px solid var(--border-color); flex-shrink: 0; padding: 5px 0; }
        .nav-btn { flex: 1; padding: 2px; background: none; border: none; color: var(--text-secondary-color); cursor: pointer; display: flex; flex-direction: column; align-items: center; font-size: 9px; text-align: center; }
        .nav-btn.active { color: var(--primary-color); }
        .nav-btn .icon { font-size: 16px; margin-bottom: 2px; }
        .card { background-color: var(--bg-color); padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid var(--border-color); }
        .spec-line { display: flex; justify-content: space-between; align-items: center; font-size: 14px; padding: 4px 0; }
        .spec-line span:first-child { color: var(--text-secondary-color); }
        .spec-line .value { font-weight: bold; color: var(--text-color); }
        .phone-card-actions { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background-color: var(--surface-color); padding: 20px; border-radius: 10px; width: 90%; max-width: 450px; box-shadow: 0 5px 25px rgba(0,0,0,0.5); max-height: 90vh; overflow-y: auto; }
        .modal-content h3 { color: var(--primary-color); }
        #logo-display { font-size: 2em; font-weight: bold; text-align: center; padding: 20px; border: 2px dashed var(--border-color); border-radius: 8px; }
        .range-slider-group { display: flex; flex-direction: column; }
        .range-slider-group input[type="range"] { margin: 10px 0 5px 0; }
        .range-slider-group output { text-align: center; color: var(--secondary-color); font-weight: bold; }
        #competition-table { width: 100%; border-collapse: collapse; font-size: 12px; }
        #competition-table th, #competition-table td { padding: 8px; text-align: left; border-bottom: 1px solid var(--border-color); }
        #competition-table th { cursor: pointer; color: var(--secondary-color); }
        #competition-table th:hover { color: var(--primary-color); }
        #competition-table th.sort-asc::after { content: ' ▲'; }
        #competition-table th.sort-desc::after { content: ' ▼'; }
        #competition-table .player-row { background-color: rgba(187, 134, 252, 0.1); font-weight: bold; }
        .text-success { color: var(--success-color); } .text-error { color: var(--error-color); } .text-warning { color: var(--warning-color); }
        .mt-20 { margin-top: 20px; } .text-small { font-size: 12px; color: var(--text-secondary-color); }
        hr.divider { border: 0; height: 1px; background-color: var(--border-color); margin: 15px 0;}

        /* Styles for Settings Screen */
        .settings-actions {
             display: grid;
             grid-template-columns: 1fr 1fr;
             gap: 10px;
             align-items: center;
        }
         .settings-actions button {
             margin-top: 0; /* Override default button margin */
         }
         .settings-actions p {
             grid-column: 1 / -1; /* Make status message span two columns */
             text-align: center;
         }
    </style>
</head>
<body>
    <div id="game-container">
        <!-- ВЕРХНЯЯ ПАНЕЛЬ -->
        <div id="status-bar">
            <div id="money"></div>
            <div id="date"></div>
            <div id="player-level-info">
                <div id="player-level-text">Уровень <span id="player-level">1</span> (<span id="player-xp">0</span> / <span id="player-xp-next">100</span> XP)</div>
                <div id="xp-bar-container"><div id="xp-bar"></div></div>
            </div>
        </div>
        <!-- ОСНОВНОЕ СОДЕРЖИМОЕ -->
        <div id="main-content">
            <!-- ЭКРАН 1: ДИЗАЙН -->
            <div id="design-screen" class="screen active">
                <h2>Проектирование новой модели</h2>
                <div class="form-group"><label for="phone-name">Название модели</label><input type="text" id="phone-name" placeholder="Например, Aura X1"></div>
                <div id="component-selectors"></div>
                <div class="form-group"><label for="phone-color">Цвет корпуса</label><select id="phone-color"></select></div>
                <div class="form-group"><label for="special-feature">Особая функция</label><select id="special-feature"></select></div>
                <div id="accessory-selectors">
                    <h3 class="section-title">Аксессуары в комплекте</h3>
                    <div id="accessory-checkboxes"></div>
                </div>
                <div id="phone-preview" class="card mt-20">
                    <h3>Предварительные характеристики</h3>
                    <div class="spec-line"><span>Производительность:</span> <span id="preview-performance">0</span></div>
                    <div class="spec-line"><span>Качество камеры:</span> <span id="preview-camera">0</span></div>
                    <div class="spec-line"><span>Батарея (ч):</span> <span id="preview-battery">0</span></div>
                    <div class="spec-line"><span>Качество дизайна:</span> <span id="preview-design">0</span></div>
                    <hr class="divider">
                    <div class="spec-line"><strong>Себестоимость комплекта:</strong> <strong id="preview-cost" class="text-error">$0</strong></div>
                </div>
                <button id="show-production-modal-btn">Перейти к производству</button>
            </div>
            <!-- ЭКРАН 2: ПРОДАЖИ -->
            <div id="sales-screen" class="screen">
                <h2>Продажи и Склад (Смартфоны)</h2>
                <div class="spec-line"><span>Общая прибыль:</span> <span id="total-profit" class="text-success">$0</span></div>
                <div class="spec-line"><span>Узнаваемость бренда:</span> <span id="brand-awareness">0 / 100</span></div>
                <hr class="divider">
                <div id="sales-list"><p>Пока нет моделей в продаже.</p></div>
            </div>
            <!-- ЭКРАН 3: АКСЕССУАРЫ -->
            <div id="accessories-screen" class="screen">
                <h2>Производство и Продажа Аксессуаров</h2>
                <div id="accessories-list"></div>
            </div>
            <!-- ЭКРАН 4: СТАТИСТИКА -->
            <div id="stats-screen" class="screen">
                <h2>Статистика Компании</h2>
                <div id="logo-display-container" class="card">
                    <h3 style="text-align: center;">Наш Бренд</h3>
                    <div id="logo-display">Pixel Perfect</div>
                </div>
                <div id="stats-content"></div>
            </div>
            <!-- ЭКРАН 5: МАРКЕТИНГ -->
            <div id="marketing-screen" class="screen">
                <h2>Маркетинг и Партнерство</h2>
                <div class="card">
                    <h3>Партнерство с ритейлерами</h3>
                    <p class="text-small">Отдайте партию телефонов в розничные сети. Они получат бонус к продажам, но вы заплатите комиссию и не сможете вернуть остатки.</p>
                    <button id="open-partnership-modal-btn" class="secondary mt-20">Заключить сделку</button>
                </div>
                <h3 class="section-title">Активные партнерства</h3>
                <div id="partnerships-list"><p class="text-small">Нет активных сделок.</p></div>
                <h3 class="section-title">Рекламные кампании</h3>
                <div id="campaigns-list"></div>
            </div>
            <!-- ЭКРАН 6: КОНКУРЕНЦИЯ -->
            <div id="competition-screen" class="screen">
                <h2>Рейтинг Производителей</h2>
                <div style="overflow-x: auto;">
                    <table id="competition-table">
                        <thead>
                            <tr>
                                <th data-sort="rank">#</th>
                                <th data-sort="name">Компания</th>
                                <th data-sort="brandAwareness">Узнаваемость</th>
                                <th data-sort="level">Уровень</th>
                                <th data-sort="money">Доход</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Заполняется динамически -->
                        </tbody>
                    </table>
                </div>
            </div>
             <!-- ЭКРАН 7: ТРЕНДЫ -->
            <div id="trends-screen" class="screen">
                <h2>Тренды Рынка</h2>
                <div id="trends-content"></div>
            </div>
            <!-- ЭКРАН 8: R&D -->
            <div id="rnd-screen" class="screen">
                <h2>Исследования и Разработки</h2>
                <div id="research-info" class="card">
                     <h3>Текущее исследование</h3>
                     <div id="current-research-status">Нет активных исследований.</div>
                </div>
                <h3 class="section-title">Доступные проекты</h3>
                <div id="research-list"></div>
            </div>
            <!-- НОВЫЙ ЭКРАН 9: НАСТРОЙКИ -->
             <div id="settings-screen" class="screen">
                 <h2>Настройки</h2>
                 <div class="card">
                     <h3>Сохранение и Загрузка</h3>
                     <div class="settings-actions mt-20">
                         <button id="save-game-btn" class="primary">💾 Сохранить игру</button>
                         <button id="load-game-btn" class="secondary">📂 Загрузить игру</button>
                         <p id="save-status" class="text-small mt-10"></p>
                     </div>
                 </div>
                 <div class="card mt-20">
                      <h3>Сброс игры</h3>
                      <p class="text-small">Внимание: Это действие удалит весь ваш прогресс! Его нельзя отменить.</p>
                      <button id="reset-game-btn" class="error mt-20">⚠️ Сбросить все сохранения</button>
                 </div>
             </div>
        </div>
        <!-- НИЖНЯЯ ПАНЕЛЬ НАВИГАЦИИ -->
        <div id="bottom-nav">
            <button class="nav-btn active" data-screen="design-screen"><span class="icon">📱</span>Дизайн</button>
            <button class="nav-btn" data-screen="sales-screen"><span class="icon">📈</span>Продажи</button>
            <button class="nav-btn" data-screen="accessories-screen"><span class="icon">🎧</span>Аксесс.</button>
            <button class="nav-btn" data-screen="stats-screen"><span class="icon">📊</span>Статистика</button>
            <button class="nav-btn" data-screen="marketing-screen"><span class="icon">📢</span>Маркетинг</button>
            <button class="nav-btn" data-screen="competition-screen"><span class="icon">🌍</span>Конкуренты</button>
            <button class="nav-btn" data-screen="trends-screen"><span class="icon">💡</span>Тренды</button>
            <button class="nav-btn" data-screen="rnd-screen"><span class="icon">🔬</span>R&D</button>
            <button class="nav-btn" data-screen="settings-screen"><span class="icon">⚙️</span>Настройки</button> <!-- НОВАЯ КНОПКА -->
        </div>
    </div>
    <!-- МОДАЛЬНЫЕ ОКНА -->
    <div id="production-modal-overlay" class="modal-overlay">
        <div class="modal-content">
            <h3>Запуск производства смартфона</h3>
            <div class="form-group mt-20"><label for="production-quantity">Количество для производства</label><input type="number" id="production-quantity"></div>
            <div class="form-group"><label for="phone-price">Розничная цена телефона</label><input type="number" id="phone-price"></div>
            <hr class="divider">
            <div class="spec-line mt-20"><strong>Общая стоимость партии:</strong><strong id="total-production-cost" class="text-error">$0</strong></div>
            <div class="phone-card-actions mt-20"><button id="confirm-production-btn" class="secondary">Подтвердить</button><button class="cancel-modal-btn danger">Отмена</button></div>
        </div>
    </div>
    <div id="partnership-modal-overlay" class="modal-overlay">
        <div class="modal-content">
            <h3>Новое партнерство</h3>
            <div class="form-group mt-20"><label for="partnership-phone-select">Выберите модель для поставки</label><select id="partnership-phone-select"></select></div>
            <div class="form-group"><label for="partnership-quantity">Количество (не более доступного на складе)</label><input type="number" id="partnership-quantity"></div>
            <div class="form-group range-slider-group"><label for="partnership-commission">Комиссия магазину (%)</label><input type="range" id="partnership-commission" min="10" max="50" value="30"><output id="partnership-commission-value">30%</output></div>
            <div class="phone-card-actions mt-20"><button id="confirm-partnership-btn" class="secondary">Подписать контракт</button><button class="cancel-modal-btn danger">Отмена</button></div>
        </div>
    </div>
    <div id="accessory-production-modal-overlay" class="modal-overlay">
        <div class="modal-content">
            <h3 id="accessory-modal-title">Производство аксессуара</h3>
            <div class="form-group mt-20"><label for="accessory-production-quantity">Количество для производства</label><input type="number" id="accessory-production-quantity"></div>
            <div class="form-group"><label for="accessory-price">Розничная цена</label><input type="number" id="accessory-price"></div>
            <hr class="divider">
            <div class="spec-line mt-20"><strong>Общая стоимость партии:</strong><strong id="accessory-total-production-cost" class="text-error">$0</strong></div>
            <div class="phone-card-actions mt-20"><button id="confirm-accessory-production-btn" class="secondary">Произвести</button><button class="cancel-modal-btn danger">Отмена</button></div>
        </div>
    </div>

    <!-- ПОДКЛЮЧЕНИЕ СКРИПТОВ КАК МОДУЛЕЙ -->
    <script src="competitors.js" type="module"></script>
    <script src="gameData.js" type="module"></script> <!-- Убедитесь, что этот файл тоже есть -->
    <script src="game.js" type="module"></script>
</body>
</html>
